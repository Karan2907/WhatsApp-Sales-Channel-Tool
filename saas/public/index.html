<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Sales Channel SaaS - Firebase</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
        }
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 10px 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            text-decoration: none;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-primary:hover {
            background-color: #0056b3;
        }
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        .btn-success:hover {
            background-color: #218838;
        }
        .btn-warning {
            background-color: #ffc107;
            color: #212529;
        }
        .btn-warning:hover {
            background-color: #e0a800;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        .hidden {
            display: none;
        }
        #message {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        .success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
        .error {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }
        .tenant-info {
            background-color: #e9f7fe;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background-color: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .endpoint {
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 4px;
        }
        .endpoint-title {
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }
        .endpoint-url {
            font-family: monospace;
            background-color: #e9ecef;
            padding: 2px 6px;
            border-radius: 3px;
            display: inline-block;
            margin-right: 10px;
        }
        .webhook-url-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .webhook-url {
            flex: 1;
            font-family: monospace;
            background-color: #e9ecef;
            padding: 8px;
            border-radius: 3px;
            margin-right: 10px;
            overflow-x: auto;
        }
        .copy-button {
            white-space: nowrap;
            padding: 5px 10px;
            font-size: 14px;
        }
        .provider-fields {
            display: none;
        }
        .provider-fields.active {
            display: block;
        }
        .divider {
            border-top: 1px solid #eee;
            margin: 30px 0;
        }
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .product-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: #f8f9fa;
        }
        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .product-header h4 {
            margin: 0;
            color: #333;
        }
        .product-price {
            font-weight: bold;
            color: #007bff;
            font-size: 1.2em;
        }
        .product-pricing {
            text-align: right;
        }
        .product-pricing .timing-info, .product-pricing .billing-info {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }
        .product-pricing-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            text-align: right;
        }
        .pricing-option {
            padding: 8px;
            border-radius: 4px;
        }
        .pricing-option.daily {
            background-color: #e3f2fd;
            border: 1px solid #bbdefb;
        }
        .pricing-option.monthly {
            background-color: #e8f5e9;
            border: 1px solid #c8e6c9;
        }
        .product-details {
            margin-bottom: 15px;
        }
        .product-description {
            margin: 10px 0;
            color: #666;
        }
        .product-meta {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 0.9em;
            color: #666;
        }
        .product-amenities {
            margin: 10px 0;
            font-size: 0.9em;
            color: #666;
        }
        .product-actions {
            display: flex;
            justify-content: space-between;
            border-top: 1px solid #eee;
            padding-top: 10px;
        }
        .modal {
            display: block;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        .modal.hidden {
            display: none;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
        }
        .booking-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .booking-table th, .booking-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .booking-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .booking-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .booking-table tr:hover {
            background-color: #f5f5f5;
        }
        .booking-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .booking-status.new {
            background-color: #fff3cd;
            color: #856404;
        }
        .booking-status.confirmed {
            background-color: #d4edda;
            color: #155724;
        }
        .booking-status.cancelled {
            background-color: #f8d7da;
            color: #721c24;
        }
        .booking-status.completed {
            background-color: #cce5ff;
            color: #004085;
        }
        .booking-details-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .booking-details-section h3 {
            margin-top: 0;
            color: #333;
        }
        .booking-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        .booking-detail-item {
            margin-bottom: 10px;
        }
        .booking-detail-label {
            font-weight: bold;
            color: #666;
            display: block;
        }
        .booking-detail-value {
            display: block;
            margin-top: 5px;
        }
        .no-products-message {
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .no-products-message ol, .no-products-message ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .sample-product {
            background-color: #e9f7fe;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin-top: 15px;
            border-radius: 4px;
        }
        .sample-product h4 {
            margin-top: 0;
            color: #007bff;
        }
        .sample-product p {
            margin: 8px 0;
        }
        .product-form.hidden {
            display: none;
        }
        .pricing-section {
            margin-bottom: 20px;
        }
        .pricing-section h5 {
            margin-bottom: 10px;
            color: #007bff;
        }
        .pricing-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .pricing-row {
            display: contents;
        }
        .pricing-header {
            font-weight: bold;
            text-align: center;
            padding: 8px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        .pricing-label {
            padding: 8px;
            border: 1px solid #dee2e6;
            display: flex;
            align-items: center;
        }
        .pricing-row input {
            width: 100%;
            padding: 8px;
            border: 1px solid #dee2e6;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>WhatsApp Sales Channel SaaS</h1>
            <p>Multi-tenant solution for booking platforms</p>
        </div>
        
        <div id="auth-section">
            <h2>Authentication</h2>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" placeholder="Enter your email">
            </div>
            
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" placeholder="Enter your password">
            </div>
            
            <div id="register-form">
                <h3>Register New Account</h3>
                <button id="google-register-btn" class="btn btn-primary">Register with Google</button>
                <p>Or register with email and password:</p>
                <button id="register-btn" class="btn btn-primary">Register with Email</button>
            </div>
            
            <div id="login-form">
                <h3>Login to Existing Account</h3>
                <button id="login-btn" class="btn btn-success">Login</button>
            </div>
        </div>
        
        <div id="dashboard-section" class="hidden">
            <div class="tabs">
                <div class="tab active" data-tab="settings">Settings</div>
                <div class="tab" data-tab="products">Products</div>
                <div class="tab" data-tab="bookings">Bookings</div>
                <div class="tab" data-tab="webhooks">Webhooks</div>
            </div>
            
            <div class="tab-content active" id="settings-tab">
                <h2>Dashboard</h2>
                <div class="tenant-info">
                    <p>Welcome, <span id="current-tenant"></span>!</p>
                    <p>Email: <span id="current-email"></span></p>
                </div>
                
                <div class="form-group">
                    <label for="api-token">API Token (Use this in your webhook headers):</label>
                    <div style="display: flex;">
                        <input type="text" id="api-token" readonly style="flex: 1; margin-right: 10px;">
                        <button id="copy-token-btn" class="btn btn-secondary copy-button">Copy</button>
                    </div>
                </div>
                
                <h3>WhatsApp Configuration</h3>
                <form id="whatsapp-settings-form">
                    <div class="form-group">
                        <label for="provider">WhatsApp Provider:</label>
                        <select id="provider" name="provider">
                            <option value="">Select a provider</option>
                            <option value="whatsapp-cloud-api">WhatsApp Cloud API (Meta)</option>
                            <option value="twilio">Twilio</option>
                            <option value="gupshup">Gupshup</option>
                        </select>
                    </div>
                    
                    <!-- WhatsApp Cloud API Fields -->
                    <div id="whatsapp-cloud-api-fields" class="provider-fields">
                        <div class="form-group">
                            <label for="accessToken">Access Token:</label>
                            <input type="password" id="accessToken" name="accessToken" value="">
                        </div>
                        <div class="form-group">
                            <label for="phoneNumberId">Phone Number ID:</label>
                            <input type="text" id="phoneNumberId" name="phoneNumberId" value="">
                        </div>
                        <div class="form-group">
                            <label for="businessAccountId">Business Account ID (optional):</label>
                            <input type="text" id="businessAccountId" name="businessAccountId" value="">
                        </div>
                    </div>

                    <!-- Twilio Fields -->
                    <div id="twilio-fields" class="provider-fields">
                        <div class="form-group">
                            <label for="accountSid">Account SID:</label>
                            <input type="password" id="accountSid" name="accountSid" value="">
                        </div>
                        <div class="form-group">
                            <label for="authToken">Auth Token:</label>
                            <input type="password" id="authToken" name="authToken" value="">
                        </div>
                        <div class="form-group">
                            <label for="phoneNumber">WhatsApp Phone Number:</label>
                            <input type="text" id="phoneNumber" name="phoneNumber" value="">
                        </div>
                    </div>

                    <!-- Gupshup Fields -->
                    <div id="gupshup-fields" class="provider-fields">
                        <div class="form-group">
                            <label for="apiKey">API Key:</label>
                            <input type="password" id="apiKey" name="apiKey" value="">
                        </div>
                        <div class="form-group">
                            <label for="appName">App Name:</label>
                            <input type="text" id="appName" name="appName" value="">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="brandName">Brand Name:</label>
                        <input type="text" id="brandName" name="brandName" value="">
                    </div>

                    <div class="form-group">
                        <label for="brandTone">Brand Tone:</label>
                        <select id="brandTone" name="brandTone">
                            <option value="friendly">Friendly</option>
                            <option value="premium">Premium</option>
                            <option value="relaxed">Relaxed</option>
                        </select>
                    </div>

                    <div class="divider"></div>
                    
                    <h3>Product API Configuration</h3>
                    
                    <div class="form-group">
                        <label for="productApiEnabled">
                            <input type="checkbox" id="productApiEnabled" name="productApiEnabled" style="width: auto; margin-right: 10px;"> 
                            Enable Product API Integration
                        </label>
                    </div>
                    
                    <div id="product-api-fields" style="display: none;">
                        <div class="form-group">
                            <label for="productApiUrl">Product API URL:</label>
                            <input type="text" id="productApiUrl" name="productApiUrl" placeholder="https://yourwebsite.com/api/products">
                        </div>
                        
                        <div class="form-group">
                            <label for="productApiAuthType">Authentication Type:</label>
                            <select id="productApiAuthType" name="productApiAuthType">
                                <option value="none">None</option>
                                <option value="bearer">Bearer Token</option>
                                <option value="basic">Basic Auth</option>
                                <option value="apikey">API Key</option>
                            </select>
                        </div>
                        
                        <div id="product-api-auth-fields">
                            <div class="form-group" id="bearer-token-field" style="display: none;">
                                <label for="productApiBearerToken">Bearer Token:</label>
                                <input type="password" id="productApiBearerToken" name="productApiBearerToken">
                            </div>
                            
                            <div class="form-group" id="basic-auth-fields" style="display: none;">
                                <label for="productApiUsername">Username:</label>
                                <input type="text" id="productApiUsername" name="productApiUsername">
                                <label for="productApiPassword">Password:</label>
                                <input type="password" id="productApiPassword" name="productApiPassword">
                            </div>
                            
                            <div class="form-group" id="api-key-field" style="display: none;">
                                <label for="productApiKeyHeader">API Key Header:</label>
                                <input type="text" id="productApiKeyHeader" name="productApiKeyHeader" placeholder="X-API-Key">
                                <label for="productApiKeyValue">API Key Value:</label>
                                <input type="password" id="productApiKeyValue" name="productApiKeyValue">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="productApiRefreshInterval">Refresh Interval (minutes):</label>
                            <input type="number" id="productApiRefreshInterval" name="productApiRefreshInterval" value="60" min="1">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">Save Settings</button>
                </form>
            </div>
            
            <div class="tab-content" id="products-tab">
                <h2>Product Management</h2>
                <p>Add, edit, and manage your accommodation products here.</p>
                
                <!-- Business Type Selection -->
                <div class="form-group">
                    <h3>Select Business Type</h3>
                    <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                        <button type="button" class="btn btn-primary" onclick="showResortForm()">
                            Resort/Hotel
                        </button>
                        <button type="button" class="btn btn-primary" onclick="showPGForm()">
                            Paying Guest (PG)
                        </button>
                    </div>
                </div>
                
                <!-- Resort/Hotel Product Form -->
                <div id="resort-form" class="product-form">
                    <h3>Add New Resort/Hotel Product</h3>
                    <form id="add-resort-product-form">
                        <div class="form-group">
                            <label for="resortProductName">Product Name:</label>
                            <input type="text" id="resortProductName" name="name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="resortProductDescription">Description:</label>
                            <textarea id="resortProductDescription" name="description" rows="3"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="resortProductPrice">Price (â‚¹):</label>
                            <input type="number" id="resortProductPrice" name="price" step="0.01" min="0">
                        </div>
                        
                        <div class="form-group">
                            <label for="resortProductCategory">Category:</label>
                            <select id="resortProductCategory" name="category">
                                <option value="room">Room</option>
                                <option value="suite">Suite</option>
                                <option value="villa">Villa</option>
                                <option value="cottage">Cottage</option>
                                <option value="tent">Tent</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="resortProductImageUrl">Image URL:</label>
                            <input type="text" id="resortProductImageUrl" name="imageUrl">
                        </div>
                        
                        <div class="form-group">
                            <label for="resortProductCapacity">Capacity (Guests):</label>
                            <input type="number" id="resortProductCapacity" name="capacity" min="1">
                        </div>
                        
                        <div class="form-group">
                            <label for="resortProductAmenities">Amenities (comma separated):</label>
                            <input type="text" id="resortProductAmenities" name="amenities">
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Add Resort Product</button>
                    </form>
                </div>
                
                <!-- PG Product Form -->
                <div id="pg-form" class="product-form hidden">
                    <h3>Add New PG Product</h3>
                    <form id="add-pg-product-form">
                        <div class="form-group">
                            <label for="pgProductName">PG Name:</label>
                            <input type="text" id="pgProductName" name="name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="pgProductDescription">Description:</label>
                            <textarea id="pgProductDescription" name="description" rows="3"></textarea>
                        </div>
                        
                        <!-- Pricing Structure for PG -->
                        <div class="form-group">
                            <h4>Pricing Structure</h4>
                            
                            <!-- Monthly Pricing -->
                            <div class="pricing-section">
                                <h5>Monthly Rates</h5>
                                <div class="pricing-grid">
                                    <div class="pricing-row">
                                        <div class="pricing-header">Sharing Option</div>
                                        <div class="pricing-header">Non-AC (â‚¹)</div>
                                        <div class="pricing-header">AC (â‚¹)</div>
                                    </div>
                                    <div class="pricing-row">
                                        <div class="pricing-label">1 Sharing</div>
                                        <div><input type="number" name="monthly_1_nonac" min="0" step="100"></div>
                                        <div><input type="number" name="monthly_1_ac" min="0" step="100"></div>
                                    </div>
                                    <div class="pricing-row">
                                        <div class="pricing-label">2 Sharing</div>
                                        <div><input type="number" name="monthly_2_nonac" min="0" step="100"></div>
                                        <div><input type="number" name="monthly_2_ac" min="0" step="100"></div>
                                    </div>
                                    <div class="pricing-row">
                                        <div class="pricing-label">3 Sharing</div>
                                        <div><input type="number" name="monthly_3_nonac" min="0" step="100"></div>
                                        <div><input type="number" name="monthly_3_ac" min="0" step="100"></div>
                                    </div>
                                    <div class="pricing-row">
                                        <div class="pricing-label">4 Sharing</div>
                                        <div><input type="number" name="monthly_4_nonac" min="0" step="100"></div>
                                        <div><input type="number" name="monthly_4_ac" min="0" step="100"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Daily Pricing -->
                            <div class="pricing-section">
                                <h5>Daily Rates</h5>
                                <div class="pricing-grid">
                                    <div class="pricing-row">
                                        <div class="pricing-header">Sharing Option</div>
                                        <div class="pricing-header">Non-AC (â‚¹)</div>
                                        <div class="pricing-header">AC (â‚¹)</div>
                                    </div>
                                    <div class="pricing-row">
                                        <div class="pricing-label">1 Sharing</div>
                                        <div><input type="number" name="daily_1_nonac" min="0" step="50"></div>
                                        <div><input type="number" name="daily_1_ac" min="0" step="50"></div>
                                    </div>
                                    <div class="pricing-row">
                                        <div class="pricing-label">2 Sharing</div>
                                        <div><input type="number" name="daily_2_nonac" min="0" step="50"></div>
                                        <div><input type="number" name="daily_2_ac" min="0" step="50"></div>
                                    </div>
                                    <div class="pricing-row">
                                        <div class="pricing-label">3 Sharing</div>
                                        <div><input type="number" name="daily_3_nonac" min="0" step="50"></div>
                                        <div><input type="number" name="daily_3_ac" min="0" step="50"></div>
                                    </div>
                                    <div class="pricing-row">
                                        <div class="pricing-label">4 Sharing</div>
                                        <div><input type="number" name="daily_4_nonac" min="0" step="50"></div>
                                        <div><input type="number" name="daily_4_ac" min="0" step="50"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="pgProductAmenities">Amenities (comma separated):</label>
                            <input type="text" id="pgProductAmenities" name="amenities">
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Add PG Product</button>
                    </form>
                </div>
                
                <div class="divider"></div>
                
                <!-- Products List -->
                <h3>Existing Products</h3>
                <div id="products-list">
                    <p>Loading products...</p>
                </div>
            </div>
            
            <div class="tab-content" id="bookings-tab">
                <h2>Booking Management</h2>
                <p>View and manage all booking requests received through WhatsApp.</p>
                
                <!-- Booking Filters -->
                <div class="form-group">
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <div>
                            <label for="bookingStatusFilter">Status:</label>
                            <select id="bookingStatusFilter">
                                <option value="all">All Bookings</option>
                                <option value="new">New Requests</option>
                                <option value="confirmed">Confirmed</option>
                                <option value="cancelled">Cancelled</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="bookingDateFilter">Date Range:</label>
                            <select id="bookingDateFilter">
                                <option value="all">All Time</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="bookingSearch">Search:</label>
                            <input type="text" id="bookingSearch" placeholder="Search by customer name or phone">
                        </div>
                        
                        <div style="align-self: flex-end;">
                            <button id="refreshBookings" class="btn btn-secondary">Refresh</button>
                        </div>
                    </div>
                </div>
                
                <!-- Bookings List -->
                <div id="bookings-list">
                    <p>Loading bookings...</p>
                </div>
                
                <!-- Booking Details Modal -->
                <div id="booking-details-modal" class="modal hidden">
                    <div class="modal-content">
                        <span class="close">&times;</span>
                        <div id="booking-details-content"></div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="webhooks-tab">
                <h3>Webhook Endpoints</h3>
                
                <div class="endpoint">
                    <div class="endpoint-title">Booking Started</div>
                    <div class="webhook-url-container">
                        <div class="webhook-url" id="booking-started-url">https://your-saas-domain.com/webhook/booking-started</div>
                        <button class="btn btn-secondary copy-button" onclick="copyToClipboard(document.getElementById('booking-started-url').textContent)">Copy</button>
                    </div>
                    <div>Triggered when a guest starts a booking</div>
                </div>
                
                <div class="endpoint">
                    <div class="endpoint-title">Booking Abandoned</div>
                    <div class="webhook-url-container">
                        <div class="webhook-url" id="booking-abandoned-url">https://your-saas-domain.com/webhook/booking-abandoned</div>
                        <button class="btn btn-secondary copy-button" onclick="copyToClipboard(document.getElementById('booking-abandoned-url').textContent)">Copy</button>
                    </div>
                    <div>Triggered when a guest abandons a booking</div>
                </div>
                
                <div class="endpoint">
                    <div class="endpoint-title">Reservation Confirmed</div>
                    <div class="webhook-url-container">
                        <div class="webhook-url" id="reservation-confirmed-url">https://your-saas-domain.com/webhook/reservation-confirmed</div>
                        <button class="btn btn-secondary copy-button" onclick="copyToClipboard(document.getElementById('reservation-confirmed-url').textContent)">Copy</button>
                    </div>
                    <div>Triggered when a reservation is confirmed</div>
                </div>
                
                <div class="endpoint">
                    <div class="endpoint-title">Guest Checked In</div>
                    <div class="webhook-url-container">
                        <div class="webhook-url" id="guest-checked-in-url">https://your-saas-domain.com/webhook/guest-checked-in</div>
                        <button class="btn btn-secondary copy-button" onclick="copyToClipboard(document.getElementById('guest-checked-in-url').textContent)">Copy</button>
                    </div>
                    <div>Triggered when a guest checks in</div>
                </div>
                
                <div class="endpoint">
                    <div class="endpoint-title">Health Check</div>
                    <div class="webhook-url-container">
                        <div class="webhook-url" id="health-check-url">https://your-saas-domain.com/health</div>
                        <button class="btn btn-secondary copy-button" onclick="copyToClipboard(document.getElementById('health-check-url').textContent)">Copy</button>
                    </div>
                    <div>Check if the service is running</div>
                </div>
                
                <div class="divider"></div>
                
                <div class="endpoint">
                    <div class="endpoint-title">Twilio Webhooks</div>
                    
                    <div style="margin-bottom: 20px;">
                        <strong>ðŸ“¨ Incoming Message Webhook</strong>
                        <div class="webhook-url-container" style="margin-top: 10px;">
                            <div class="webhook-url" id="twilio-message-webhook-url">Loading...</div>
                            <button class="btn btn-secondary copy-button" onclick="copyToClipboard(document.getElementById('twilio-message-webhook-url').textContent)">Copy</button>
                        </div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">Configure this in Twilio Console â†’ WhatsApp Sandbox â†’ "When a message comes in"</div>
                    </div>
                    
                    <div>
                        <strong>ðŸ“Š Status Callback Webhook</strong>
                        <div class="webhook-url-container" style="margin-top: 10px;">
                            <div class="webhook-url" id="twilio-status-webhook-url">Loading...</div>
                            <button class="btn btn-secondary copy-button" onclick="copyToClipboard(document.getElementById('twilio-status-webhook-url').textContent)">Copy</button>
                        </div>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">Configure this in Twilio Console for message delivery status updates</div>
                    </div>
                </div>
            </div>
            
            <button id="logout-btn" class="btn btn-warning">Logout</button>
        </div>
        
        <div id="message"></div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA3ZxhBq7tGPjirtrGYUMCDkc8YvNLjtY0",
            authDomain: "whatsapp-sales-channel.firebaseapp.com",
            projectId: "whatsapp-sales-channel",
            storageBucket: "whatsapp-sales-channel.firebasestorage.app",
            messagingSenderId: "111488607176",
            appId: "1:111488607176:web:087e7bc306e46fea4d96fd",
            measurementId: "G-W01FDCZ0G6"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // DOM elements
        const authSection = document.getElementById('auth-section');
        const dashboardSection = document.getElementById('dashboard-section');
        const messageDiv = document.getElementById('message');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const apiTokenInput = document.getElementById('api-token');
        const currentTenantSpan = document.getElementById('current-tenant');
        const currentEmailSpan = document.getElementById('current-email');
        
        // Tab switching functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and content
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab
                tab.classList.add('active');
                
                // Show corresponding content
                const tabName = tab.getAttribute('data-tab');
                document.getElementById(`${tabName}-tab`).classList.add('active');
                
                // Load data if switching to products or bookings tab
                if (tabName === 'products') {
                    loadProducts();
                } else if (tabName === 'bookings') {
                    loadBookings();
                }
            });
        });
        
        // Function to safely attach event listeners
        function attachEventListener(elementId, eventType, handler) {
            const element = document.getElementById(elementId);
            if (element) {
                element.addEventListener(eventType, handler);
                console.log(`Event listener attached to ${elementId}`);
            } else {
                console.warn(`Element with ID ${elementId} not found`);
            }
        }
        
        // Initialize event listeners
        document.getElementById('register-btn').addEventListener('click', registerTenant);
        document.getElementById('google-register-btn').addEventListener('click', signInWithGoogle);
        document.getElementById('login-btn').addEventListener('click', loginTenant);
        document.getElementById('logout-btn').addEventListener('click', logoutTenant);
        
        // Product form submit handlers
        document.getElementById('add-resort-product-form').addEventListener('submit', handleResortProductSubmit);
        document.getElementById('add-pg-product-form').addEventListener('submit', handlePGProductSubmit);
        
        // Prevent auth state loop
        let isAuthStateChanging = false;
        
        // Check if already logged in
        auth.onAuthStateChanged(async user => {
            if (isAuthStateChanging) {
                console.log('[AuthStateChange] Blocked - already processing auth state change');
                return;
            }
            
            isAuthStateChanging = true;
            console.log('[AuthStateChange] User:', user ? user.email : 'null');
            
            try {
                if (user) {
                    // User is signed in, get ID token with custom claims
                    try {
                        // Get existing token first (don't force refresh on every state change)
                        const tokenResult = await user.getIdTokenResult();
                        console.log('[AuthStateChange] Token claims:', tokenResult.claims);
                        
                        if (tokenResult.claims.tenantId) {
                            // Token has tenant info, store it and show dashboard
                            const idToken = await user.getIdToken(); // Get without forcing refresh
                            localStorage.setItem('firebaseIdToken', idToken);
                            console.log('[AuthStateChange] Token has tenantId, showing dashboard');
                            showDashboard(user, null);
                        } else {
                            // Token doesn't have tenant info yet, sign out
                            console.log('[AuthStateChange] Token missing tenant claims, signing out');
                            await auth.signOut();
                            showAuth();
                        }
                    } catch (error) {
                        console.error('[AuthStateChange] Error getting token:', error);
                        showAuth();
                    }
                } else {
                    console.log('[AuthStateChange] No user, showing auth');
                    showAuth();
                }
            } finally {
                // Reset flag after a short delay to allow for legitimate state changes
                setTimeout(() => {
                    isAuthStateChanging = false;
                    console.log('[AuthStateChange] Flag reset, ready for next auth state change');
                }, 1000);
            }
        });
        
        // Register new tenant
        async function registerTenant() {
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();
            
            if (!email || !password) {
                showMessage('Please enter email and password', 'error');
                return;
            }
            
            try {
                // Create user with email and password in Firebase
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Auto-generate tenant ID from email
                const tenantId = generateTenantId(email);
                
                // Register with backend
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        email, 
                        password, 
                        tenantId,
                        displayName: email.split('@')[0]
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('Registration successful!', 'success');
                    // Store the custom token for later use
                    localStorage.setItem('customToken', data.customToken);
                    
                    // Force token refresh to get the updated custom claims
                    await user.getIdToken(true); // Force refresh
                    const idToken = await user.getIdToken();
                    localStorage.setItem('firebaseIdToken', idToken);
                    
                    // Show dashboard after successful registration
                    showDashboard(user, data.customToken);
                } else {
                    showMessage(data.error || 'Registration failed', 'error');
                }
            } catch (error) {
                showMessage('Error during registration: ' + error.message, 'error');
            }
        }
        
        // Sign in with Google
        async function signInWithGoogle() {
            console.log('Google sign-in button clicked');
            try {
                console.log('Initializing Google sign-in');
                const provider = new firebase.auth.GoogleAuthProvider();
                console.log('Provider created:', provider);
                const result = await auth.signInWithPopup(provider);
                console.log('Sign-in result:', result);
                const user = result.user;
                
                // Auto-generate tenant ID from email
                const tenantId = generateTenantId(user.email);
                
                // Register with backend (this will either create a new tenant or log in existing one)
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        email: user.email, 
                        password: 'google-auth',
                        tenantId,
                        displayName: user.displayName
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('Google sign-in successful!', 'success');
                    // Store the custom token for later use
                    localStorage.setItem('customToken', data.customToken);
                    
                    // Force token refresh to get the updated custom claims
                    await user.getIdToken(true); // Force refresh
                    const idToken = await user.getIdToken();
                    localStorage.setItem('firebaseIdToken', idToken);
                    
                    // Show dashboard after successful Google sign-in
                    showDashboard(user, data.customToken);
                } else {
                    showMessage(data.error || 'Google sign-in failed', 'error');
                }
            } catch (error) {
                console.error('Error during Google sign-in:', error);
                showMessage('Error during Google sign-in: ' + error.message, 'error');
            }
        }
        
        // Generate tenant ID from email (consistent, no random component)
        function generateTenantId(email) {
            // Create a consistent tenant ID based only on email prefix
            // This ensures the same user always gets the same tenant ID
            const emailPrefix = email.split('@')[0].toLowerCase().replace(/[^a-z0-9]/g, '');
            return emailPrefix; // No random suffix - always the same for same email
        }
        
        // Login to existing tenant
        async function loginTenant() {
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();
            
            if (!email || !password) {
                showMessage('Please enter email and password', 'error');
                return;
            }
            
            try {
                // Sign in with Firebase
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Login with backend
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('Login successful!', 'success');
                    // Store the custom token for later use
                    localStorage.setItem('customToken', data.customToken);
                    
                    // Force token refresh to get the updated custom claims
                    await user.getIdToken(true); // Force refresh
                    const idToken = await user.getIdToken();
                    localStorage.setItem('firebaseIdToken', idToken);
                    
                    // Show dashboard after successful login
                    showDashboard(user, data.customToken);
                } else {
                    showMessage(data.error || 'Login failed', 'error');
                }
            } catch (error) {
                showMessage('Error during login: ' + error.message, 'error');
            }
        }
        
        // Logout
        async function logoutTenant() {
            try {
                await auth.signOut();
                // Clear stored custom token
                localStorage.removeItem('customToken');
                showMessage('You have been logged out', 'success');
            } catch (error) {
                showMessage('Error during logout: ' + error.message, 'error');
            }
        }
        
        // Show authentication section
        function showAuth() {
            authSection.classList.remove('hidden');
            dashboardSection.classList.add('hidden');
            emailInput.value = '';
            passwordInput.value = '';
        }
        
        // Show dashboard section
        async function showDashboard(user, customToken) {
            authSection.classList.add('hidden');
            dashboardSection.classList.remove('hidden');
            currentTenantSpan.textContent = user.email.split('@')[0] || 'Unknown';
            currentEmailSpan.textContent = user.email;
            
            // Get Firebase ID token for API requests
            try {
                const idToken = await user.getIdToken();
                localStorage.setItem('firebaseIdToken', idToken);
                
                // Display the custom token for webhook use
                if (apiTokenInput) {
                    if (customToken) {
                        apiTokenInput.value = customToken;
                    } else {
                        apiTokenInput.value = 'Token not available';
                    }
                }
            } catch (error) {
                console.error('Error getting ID token:', error);
                showMessage('Error getting authentication token', 'error');
            }
            
            // Populate webhook URLs with current domain
            const currentDomain = window.location.origin; // Gets http://localhost:3001 or ngrok URL
            const messageWebhookUrl = `${currentDomain}/twilio/webhook/message`;
            const statusWebhookUrl = `${currentDomain}/twilio/webhook/status`;
            
            const messageWebhookEl = document.getElementById('twilio-message-webhook-url');
            const statusWebhookEl = document.getElementById('twilio-status-webhook-url');
            
            if (messageWebhookEl) {
                messageWebhookEl.textContent = messageWebhookUrl;
            }
            if (statusWebhookEl) {
                statusWebhookEl.textContent = statusWebhookUrl;
            }
            
            // Load settings and products
            console.log('[showDashboard] Loading settings and products...');
            loadSettings();
            loadProducts();
        }
        
        // Load products function
        async function loadProducts() {
            console.log('[loadProducts] Starting to load products...');
            try {
                const idToken = localStorage.getItem('firebaseIdToken');
                console.log('[loadProducts] firebaseIdToken from localStorage:', idToken ? idToken.substring(0, 50) + '...' : 'null');
                
                if (!idToken) {
                    console.log('[loadProducts] No firebaseIdToken, checking user auth state...');
                    const user = auth.currentUser;
                    console.log('[loadProducts] Current user:', user ? user.email : 'null');
                    if (user) {
                        console.log('[loadProducts] User logged in, getting fresh token...');
                        const freshToken = await user.getIdToken();
                        console.log('[loadProducts] Fresh token obtained:', freshToken.substring(0, 50) + '...');
                        localStorage.setItem('firebaseIdToken', freshToken);
                        console.log('[loadProducts] Token saved to localStorage');
                        // Retry with new token
                        const response = await fetch('/api/products', {
                            headers: {
                                'Authorization': `Bearer ${freshToken}`
                            }
                        });
                        console.log('[loadProducts] Response status:', response.status);
                        if (response.ok) {
                            const products = await response.json();
                            console.log('[loadProducts] Products received:', products.length, 'products');
                            displayProducts(products);
                        } else {
                            const errorData = await response.json().catch(() => ({}));
                            console.error('[loadProducts] Failed:', response.status, errorData);
                            document.getElementById('products-list').innerHTML = '<p>Error loading products</p>';
                        }
                        return;
                    } else {
                        console.log('[loadProducts] No user logged in');
                        document.getElementById('products-list').innerHTML = '<p>No products found. Add your first product above!</p>';
                        return;
                    }
                }
                
                console.log('[loadProducts] Fetching products from API with stored token...');
                const response = await fetch('/api/products', {
                    headers: {
                        'Authorization': `Bearer ${idToken}`
                    }
                });
                
                console.log('[loadProducts] Response status:', response.status);
                console.log('[loadProducts] Response ok:', response.ok);
                
                if (response.status === 401) {
                    console.error('[loadProducts] 401 Unauthorized - Token might be expired, getting fresh token...');
                    const user = auth.currentUser;
                    if (user) {
                        const freshToken = await user.getIdToken(true); // Force refresh
                        console.log('[loadProducts] Fresh token obtained after 401');
                        localStorage.setItem('firebaseIdToken', freshToken);
                        // Retry once with fresh token
                        const retryResponse = await fetch('/api/products', {
                            headers: {
                                'Authorization': `Bearer ${freshToken}`
                            }
                        });
                        console.log('[loadProducts] Retry response status:', retryResponse.status);
                        if (retryResponse.ok) {
                            const products = await retryResponse.json();
                            console.log('[loadProducts] Products received after retry:', products.length, 'products');
                            displayProducts(products);
                        } else {
                            const errorData = await retryResponse.json().catch(() => ({}));
                            console.error('[loadProducts] Retry failed:', retryResponse.status, errorData);
                            document.getElementById('products-list').innerHTML = '<p>Error loading products. Please try refreshing the page.</p>';
                        }
                        return;
                    }
                }
                
                if (response.ok) {
                    const products = await response.json();
                    console.log('[loadProducts] Products received:', products.length, 'products');
                    console.log('[loadProducts] Products data:', products);
                    displayProducts(products);
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    console.error('[loadProducts] Failed to load products:', response.status, errorData);
                    document.getElementById('products-list').innerHTML = '<p>Error loading products</p>';
                }
            } catch (error) {
                console.error('[loadProducts] Error loading products:', error);
                document.getElementById('products-list').innerHTML = '<p>Error loading products</p>';
            }
        }
        
        // Display products function
        function displayProducts(products) {
            const productsList = document.getElementById('products-list');
            
            if (!products || products.length === 0) {
                productsList.innerHTML = '<p>No products found. Add your first product above!</p>';
                return;
            }
            
            let html = '<div class="products-grid">';
            
            products.forEach(product => {
                html += `
                    <div class="product-card">
                        <h4>${product.name || 'Unnamed Product'}</h4>
                        <p><strong>Type:</strong> ${product.type || 'N/A'}</p>
                        ${product.description ? `<p>${product.description}</p>` : ''}
                        ${product.price ? `<p><strong>Price:</strong> â‚¹${product.price}</p>` : ''}
                        ${product.category ? `<p><strong>Category:</strong> ${product.category}</p>` : ''}
                        <button class="btn btn-secondary" onclick="deleteProduct('${product.id}')">Delete</button>
                    </div>
                `;
            });
            
            html += '</div>';
            productsList.innerHTML = html;
        }
        
        // Delete product function
        async function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product?')) {
                return;
            }
            
            try {
                const idToken = localStorage.getItem('firebaseIdToken');
                if (!idToken) {
                    showMessage('Not authenticated. Please log in again.', 'error');
                    return;
                }
                
                const response = await fetch(`/api/products/${productId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${idToken}`
                    }
                });
                
                if (response.ok) {
                    showMessage('Product deleted successfully!', 'success');
                    loadProducts();
                } else {
                    const data = await response.json();
                    showMessage(data.error || 'Failed to delete product', 'error');
                }
            } catch (error) {
                showMessage('Error deleting product: ' + error.message, 'error');
            }
        }
        
        // Show Resort/Hotel form
        function showResortForm() {
            document.getElementById('resort-form').classList.remove('hidden');
            document.getElementById('pg-form').classList.add('hidden');
        }
        
        // Show PG form
        function showPGForm() {
            document.getElementById('resort-form').classList.add('hidden');
            document.getElementById('pg-form').classList.remove('hidden');
        }
        
        // Handle Resort Product Form Submission
        async function handleResortProductSubmit(e) {
            e.preventDefault();
            
            try {
                // Get fresh token immediately before submission
                const user = auth.currentUser;
                if (!user) {
                    showMessage('Not authenticated. Please log in again.', 'error');
                    return;
                }
                
                // Force fresh token
                const idToken = await user.getIdToken(true);
                localStorage.setItem('firebaseIdToken', idToken);
                
                const formData = new FormData(e.target);
            const product = {
                type: 'resort',
                name: formData.get('name'),
                description: formData.get('description'),
                price: parseFloat(formData.get('price')) || 0,
                category: formData.get('category'),
                imageUrl: formData.get('imageUrl'),
                capacity: parseInt(formData.get('capacity')) || 1,
                amenities: formData.get('amenities') ? formData.get('amenities').split(',').map(a => a.trim()) : []
            };
            
            // Submit product to backend
            const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${idToken}`
                    },
                    body: JSON.stringify(product)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('Resort product added successfully!', 'success');
                    e.target.reset();
                    loadProducts();
                } else {
                    showMessage(data.error || 'Failed to add resort product', 'error');
                }
            } catch (error) {
                console.error('Error adding resort product:', error);
                showMessage('Error: ' + error.message, 'error');
            }
        }
        
        // Handle PG Product Form Submission
        async function handlePGProductSubmit(e) {
            e.preventDefault();
            
            try {
                // Get fresh token immediately before submission
                const user = auth.currentUser;
                if (!user) {
                    showMessage('Not authenticated. Please log in again.', 'error');
                    return;
                }
                
                // Force fresh token
                const idToken = await user.getIdToken(true);
                localStorage.setItem('firebaseIdToken', idToken);
                
                const formData = new FormData(e.target);
            
            // Collect PG pricing data
            const pricing = {
                monthly: {
                    '1_sharing': {
                        nonac: parseFloat(formData.get('monthly_1_nonac')) || 0,
                        ac: parseFloat(formData.get('monthly_1_ac')) || 0
                    },
                    '2_sharing': {
                        nonac: parseFloat(formData.get('monthly_2_nonac')) || 0,
                        ac: parseFloat(formData.get('monthly_2_ac')) || 0
                    },
                    '3_sharing': {
                        nonac: parseFloat(formData.get('monthly_3_nonac')) || 0,
                        ac: parseFloat(formData.get('monthly_3_ac')) || 0
                    },
                    '4_sharing': {
                        nonac: parseFloat(formData.get('monthly_4_nonac')) || 0,
                        ac: parseFloat(formData.get('monthly_4_ac')) || 0
                    }
                },
                daily: {
                    '1_sharing': {
                        nonac: parseFloat(formData.get('daily_1_nonac')) || 0,
                        ac: parseFloat(formData.get('daily_1_ac')) || 0
                    },
                    '2_sharing': {
                        nonac: parseFloat(formData.get('daily_2_nonac')) || 0,
                        ac: parseFloat(formData.get('daily_2_ac')) || 0
                    },
                    '3_sharing': {
                        nonac: parseFloat(formData.get('daily_3_nonac')) || 0,
                        ac: parseFloat(formData.get('daily_3_ac')) || 0
                    },
                    '4_sharing': {
                        nonac: parseFloat(formData.get('daily_4_nonac')) || 0,
                        ac: parseFloat(formData.get('daily_4_ac')) || 0
                    }
                }
            };
            
            const product = {
                type: 'pg',
                name: formData.get('name'),
                description: formData.get('description'),
                pricing: pricing,
                amenities: formData.get('amenities') ? formData.get('amenities').split(',').map(a => a.trim()) : []
            };
            
            // Submit product to backend
            const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${idToken}`
                    },
                    body: JSON.stringify(product)
                });
                
                console.log('Response status:', response.status);
                console.log('Response ok:', response.ok);
                
                const data = await response.json();
                console.log('Response data:', data);
                
                if (response.ok) {
                    console.log('[PG Submit] Product saved successfully, reloading products...');
                    showMessage('PG product added successfully!', 'success');
                    e.target.reset();
                    loadProducts();
                } else {
                    console.error('Error response:', data);
                    if (response.status === 401) {
                        showMessage('Session expired. Token error: ' + (data.error || 'Unknown'), 'error');
                    } else {
                        showMessage(data.error || 'Failed to add PG product', 'error');
                    }
                }
            } catch (error) {
                console.error('Error adding PG product:', error);
                showMessage('Error: ' + error.message, 'error');
            }
        }
        

        
        // Load bookings function
        async function loadBookings() {
            try {
                // Get the custom token from localStorage
                const customToken = localStorage.getItem('customToken');
                if (!customToken) {
                    return;
                }
                
                // Get filter values
                const statusFilter = document.getElementById('bookingStatusFilter').value;
                const dateFilter = document.getElementById('bookingDateFilter').value;
                const searchTerm = document.getElementById('bookingSearch').value;
                
                // Fetch bookings from backend
                const response = await fetch(`/api/bookings?status=${statusFilter}&date=${dateFilter}&search=${encodeURIComponent(searchTerm)}`, {
                    headers: {
                        'Authorization': `Bearer ${customToken}`
                    }
                });
                
                const bookings = await response.json();
                
                if (response.ok) {
                    displayBookings(bookings);
                } else {
                    document.getElementById('bookings-list').innerHTML = '<p>Error loading bookings</p>';
                }
            } catch (error) {
                console.error('Error loading bookings:', error);
                document.getElementById('bookings-list').innerHTML = '<p>Error loading bookings</p>';
            }
        }
        
        // Display bookings function
        function displayBookings(bookings) {
            const bookingsList = document.getElementById('bookings-list');
            bookingsList.innerHTML = '';
            
            if (bookings.length === 0) {
                bookingsList.innerHTML = '<p>No bookings found</p>';
                return;
            }
            
            bookings.forEach(booking => {
                const bookingElement = document.createElement('div');
                bookingElement.classList.add('booking-item');
                bookingElement.innerHTML = `
                    <h3>${booking.resortName}</h3>
                    <p><strong>Check-in:</strong> ${booking.checkIn}</p>
                    <p><strong>Check-out:</strong> ${booking.checkOut}</p>
                    <p><strong>Guests:</strong> ${booking.guests}</p>
                    <p><strong>Status:</strong> ${booking.status}</p>
                `;
                bookingsList.appendChild(bookingElement);
            });
        }
        
        // Sign in with Google function
        function signInWithGoogle() {
            console.log('Google sign-in button clicked');
            // This function should handle the Google sign-in process
            // For demonstration, we'll just log a message
            console.log('Google sign-in process initiated');
        }
        
        // Display bookings function
        function displayBookings(bookings) {
            const bookingsList = document.getElementById('bookings-list');
            
            if (!bookings || bookings.length === 0) {
                bookingsList.innerHTML = '<p>No bookings found.</p>';
                return;
            }
            
            let html = `
                <table class="booking-table">
                    <thead>
                        <tr>
                            <th>Booking ID</th>
                            <th>Customer</th>
                            <th>Product</th>
                            <th>Dates</th>
                            <th>Price</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            bookings.forEach(booking => {
                html += `
                    <tr>
                        <td>${booking.id.substring(0, 8)}</td>
                        <td>
                            <div>${booking.customerName || 'N/A'}</div>
                            <div>${booking.customerPhone || 'N/A'}</div>
                        </td>
                        <td>${booking.productName || 'N/A'}</td>
                        <td>
                            <div>${formatDate(booking.checkInDate) || 'N/A'}</div>
                            <div>${formatDate(booking.checkOutDate) || 'N/A'}</div>
                        </td>
                        <td>â‚¹${booking.totalPrice || 0}</td>
                        <td><span class="booking-status ${booking.status || 'new'}">${booking.status || 'New'}</span></td>
                        <td>
                            <button class="btn btn-secondary" onclick="viewBookingDetails('${booking.id}')">View</button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
            `;
            
            bookingsList.innerHTML = html;
        }
        
        // View booking details function
        async function viewBookingDetails(bookingId) {
            try {
                // Get the custom token from localStorage
                const customToken = localStorage.getItem('customToken');
                if (!customToken) {
                    return;
                }
                
                // Fetch booking details from backend
                const response = await fetch(`/api/bookings/${bookingId}`, {
                    headers: {
                        'Authorization': `Bearer ${customToken}`
                    }
                });
                
                const booking = await response.json();
                
                if (response.ok) {
                    displayBookingDetails(booking);
                } else {
                    showMessage('Error loading booking details', 'error');
                }
            } catch (error) {
                console.error('Error loading booking details:', error);
                showMessage('Error loading booking details', 'error');
            }
        }
        
        // Display booking details function
        function displayBookingDetails(booking) {
            const modal = document.getElementById('booking-details-modal');
            const content = document.getElementById('booking-details-content');
            
            let html = `
                <h2>Booking Details</h2>
                
                <div class="booking-details-section">
                    <h3>Booking Information</h3>
                    <div class="booking-details-grid">
                        <div class="booking-detail-item">
                            <span class="booking-detail-label">Booking ID:</span>
                            <span class="booking-detail-value">${booking.id}</span>
                        </div>
                        <div class="booking-detail-item">
                            <span class="booking-detail-label">Status:</span>
                            <span class="booking-detail-value"><span class="booking-status ${booking.status || 'new'}">${booking.status || 'New'}</span></span>
                        </div>
                        <div class="booking-detail-item">
                            <span class="booking-detail-label">Booking Date:</span>
                            <span class="booking-detail-value">${formatDateTime(booking.createdAt) || 'N/A'}</span>
                        </div>
                        <div class="booking-detail-item">
                            <span class="booking-detail-label">Last Updated:</span>
                            <span class="booking-detail-value">${formatDateTime(booking.updatedAt) || 'N/A'}</span>
                        </div>
                    </div>
                </div>
                
                <div class="booking-details-section">
                    <h3>Customer Information</h3>
                    <div class="booking-details-grid">
                        <div class="booking-detail-item">
                            <span class="booking-detail-label">Name:</span>
                            <span class="booking-detail-value">${booking.customerName || 'N/A'}</span>
                        </div>
                        <div class="booking-detail-item">
                            <span class="booking-detail-label">Phone:</span>
                            <span class="booking-detail-value">${booking.customerPhone || 'N/A'}</span>
                        </div>
                        <div class="booking-detail-item">
                            <span class="booking-detail-label">Email:</span>
                            <span class="booking-detail-value">${booking.customerEmail || 'N/A'}</span>
                        </div>
                        <div class="booking-detail-item">
                            <span class="booking-detail-label">WhatsApp ID:</span>
                            <span class="booking-detail-value">${booking.customerWhatsAppId || 'N/A'}</span>
                        </div>
                    </div>
                </div>
                
                <div class="booking-details-section">
                    <h3>Product Information</h3>
                    <div class="booking-details-grid">
                        <div class="booking-detail-item">
                            <span class="booking-detail-label">Product Name:</span>
                            <span class="booking-detail-value">${booking.productName || 'N/A'}</span>
                        </div>
                        <div class="booking-detail-item">
                            <span class="booking-detail-label">Product ID:</span>
                            <span class="booking-detail-value">${booking.productId || 'N/A'}</span>
                        </div>
                        <div class="booking-detail-item">
                            <span class="booking-detail-label">Booking Type:</span>
                            <span class="booking-detail-value">${booking.bookingType || 'N/A'}</span>
                        </div>
                        <div class="booking-detail-item">
                            <span class="booking-detail-label">Price Type:</span>
                            <span class="booking-detail-value">${booking.priceType || 'N/A'}</span>
                        </div>
                    </div>
                </div>
                
                <div class="booking-details-section">
                    <h3>Booking Dates & Pricing</h3>
                    <div class="booking-details-grid">
                        <div class="booking-detail-item">
                            <span class="booking-detail-label">Check-in Date:</span>
                            <span class="booking-detail-value">${formatDate(booking.checkInDate) || 'N/A'}</span>
                        </div>
                        <div class="booking-detail-item">
                            <span class="booking-detail-label">Check-out Date:</span>
                            <span class="booking-detail-value">${formatDate(booking.checkOutDate) || 'N/A'}</span>
                        </div>
                        <div class="booking-detail-item">
                            <span class="booking-detail-label">Number of Days:</span>
                            <span class="booking-detail-value">${booking.numberOfDays || 'N/A'}</span>
                        </div>
                        <div class="booking-detail-item">
                            <span class="booking-detail-label">Total Price:</span>
                            <span class="booking-detail-value">â‚¹${booking.totalPrice || 0}</span>
                        </div>
                    </div>
                </div>
                
                <div class="booking-details-section">
                    <h3>Additional Information</h3>
                    <div class="booking-detail-item">
                        <span class="booking-detail-label">Special Requests:</span>
                        <span class="booking-detail-value">${booking.specialRequests || 'None'}</span>
                    </div>
                    <div class="booking-detail-item">
                        <span class="booking-detail-label">Notes:</span>
                        <span class="booking-detail-value">${booking.notes || 'None'}</span>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="updateBookingStatus('${booking.id}', 'confirmed')">Confirm Booking</button>
                    <button class="btn btn-warning" onclick="updateBookingStatus('${booking.id}', 'cancelled')">Cancel Booking</button>
                    <button class="btn btn-secondary" onclick="updateBookingStatus('${booking.id}', 'completed')">Mark as Completed</button>
                </div>
            `;
            
            content.innerHTML = html;
            modal.classList.remove('hidden');
        }
        
        // Update booking status function
        async function updateBookingStatus(bookingId, status) {
            try {
                // Get the custom token from localStorage
                const customToken = localStorage.getItem('customToken');
                if (!customToken) {
                    showMessage('Not authenticated. Please log in again.', 'error');
                    return;
                }
                
                // Update booking status
                const response = await fetch(`/api/bookings/${bookingId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${customToken}`
                    },
                    body: JSON.stringify({ status })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage(`Booking status updated to ${status}`, 'success');
                    document.getElementById('booking-details-modal').classList.add('hidden');
                    loadBookings(); // Refresh bookings list
                } else {
                    showMessage(data.error || 'Failed to update booking status', 'error');
                }
            } catch (error) {
                showMessage('Error updating booking status: ' + error.message, 'error');
            }
        }
        
        // Helper function to format date
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-IN');
        }
        
        // Helper function to format date and time
        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return 'N/A';
            const date = new Date(dateTimeString);
            return date.toLocaleString('en-IN');
        }
        
        // Debounce function for search
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            const tariffInfo = document.getElementById('tariffInfo');
            tariffInfo.innerHTML = `
                <h3>Queen's PG Tariff Information</h3>
                <p>Effective Date: <span id="effectiveDate"></span></p>
                <p>Rate: <span id="rate"></span></p>
                <p>Rate Type: <span id="rateType"></span></p>
                <p>Rate Description: <span id="rateDescription"></span></p>
            `;
        }
        
        // Helper function to format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString(undefined, options);
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle search
        async function handleSearch(query) {
            try {
                const response = await fetch(`/api/products?search=${encodeURIComponent(query)}`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const products = await response.json();
                displayProducts(products);
            } catch (error) {
                showMessage('Failed to fetch products', 'error');
            }
        }
        
        // Function to fetch and display products
        async function fetchProducts() {
            try {
                const response = await fetch('/api/products');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const products = await response.json();
                displayProducts(products);
            } catch (error) {
                showMessage('Failed to fetch products', 'error');
            }
        }
        
        // Function to display products
        function displayProducts(products) {
            const productsContainer = document.getElementById('productsContainer');
            productsContainer.innerHTML = '';
            products.forEach(product => {
                const productElement = document.createElement('div');
                productElement.className = 'product';
                productElement.innerHTML = `
                    <h3>${product.name}</h3>
                    <p>${product.description}</p>
                    <p>Price: $${product.price}</p>
                    <p>Added on: ${formatDate(product.date)}</p>
                    <div class="product-images">
                        ${product.images.map(image => `<img src="${image}" alt="${product.name} image" />`).join('')}
                    </div>
                `;
                productsContainer.appendChild(productElement);
            });
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission
        async function handleProductFormSubmission(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        }
        

        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission
        async function handleProductFormSubmission(e) {
            e.preventDefault();
            try {
                const formData = new FormData(e.target);
                const imageFiles = formData.getAll('images');
                const product = {};
                
                for (const [key, value] of formData.entries()) {
                    if (key === 'images') {
                        continue;
                    }
                        
                    if (key === 'amenities' && value) {
                        // Split amenities into array
                        product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                    } else if (key === 'price' && value) {
                        // Convert price to number
                        product[key] = parseFloat(value);
                    } else if (key === 'capacity' && value) {
                        // Convert capacity to number
                        product[key] = parseInt(value);
                    } else {
                        product[key] = value;
                    }
                }
                    
                // If files are selected, upload them first
                let imageUrls = [];
                if (imageFiles.length > 0) {
                    imageUrls = await uploadProductImages(imageFiles, customToken);
                }
                    
                // Add uploaded image URLs to product data
                if (imageUrls.length > 0) {
                    product.imageUrls = imageUrls;
                }
                    
                // Send product to backend
                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${customToken}`
                    },
                    body: JSON.stringify(product)
                });
                    
                const data = await response.json();
                    
                if (response.ok) {
                    showMessage('Product added successfully!', 'success');
                    e.target.reset(); // Reset form
                    loadProducts(); // Refresh product list
                } else {
                    showMessage(data.error || 'Failed to add product', 'error');
                }
            } catch (error) {
                showMessage('Error adding product: ' + error.message, 'error');
            }
        }
        

        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractWordContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const data = event.target.result;
                    const zip = new JSZip();
                    zip.loadAsync(data).then(function(zip) {
                        const doc = new mammoth.Document();
                        zip.file('word/document.xml').async('string').then(function(text) {
                            mammoth.convertToHtml({value: text, type: 'string'}).then(function(result) {
                                resolve(result.value);
                            }).catch(function(err) {
                                reject(err);
                            });
                        }).catch(function(err) {
                            reject(err);
                        });
                    }).catch(function(err) {
                        reject(err);
                    });
                };
                reader.onerror = function(event) {
                    reject(event.target.error);
                };
                reader.readAsArrayBuffer(file);
            });
        }
        
        // Function to upload product images
        function uploadProductImages(files, token) {
            return Promise.all(files.map(file => {
                const formData = new FormData();
                formData.append('image', file);
                return fetch('/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                }).then(response => response.json()).then(data => data.url);
            }));
        }
        
        // Function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Function to show messages
        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            messageContainer.textContent = message;
            messageContainer.className = `message ${type}`;
            messageContainer.style.display = 'block';
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 3000);
        }
        
        // Function to handle product form submission (OLD - keeping for compatibility)
        {
            const productForm = document.getElementById('productForm');
            if (productForm) {
                productForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const imageFiles = formData.getAll('images');
            const product = {};
            
            for (const [key, value] of formData.entries()) {
                if (key === 'images') {
                    continue;
                }
                    
                if (key === 'amenities' && value) {
                    // Split amenities into array
                    product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                } else if (key === 'price' && value) {
                    // Convert price to number
                    product[key] = parseFloat(value);
                } else if (key === 'capacity' && value) {
                    // Convert capacity to number
                    product[key] = parseInt(value);
                } else {
                    product[key] = value;
                }
            }
                
            // If files are selected, upload them first
            let imageUrls = [];
            if (imageFiles.length > 0) {
                imageUrls = await uploadProductImages(imageFiles, customToken);
            }
                
            // Add uploaded image URLs to product data
            if (imageUrls.length > 0) {
                product.imageUrls = imageUrls;
            }
                
            // Send product to backend
            const response = await fetch('/api/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${customToken}`
                },
                body: JSON.stringify(product)
            });
                
            const data = await response.json();
                
            if (response.ok) {
                showMessage('Product added successfully!', 'success');
                e.target.reset(); // Reset form
                loadProducts(); // Refresh product list
            } else {
                showMessage(data.error || 'Failed to add product', 'error');
            }
        });
        }
        }
        
        // Function to add Queen's PG tariff information
        function addQueensPGTariff() {
            // This function would pre-fill the form with Queen's PG information
            // For now, we'll just show a message with the tariff details
            const tariffInfo = `
                Queen's PG Tariff Information:
                
                Monthly Rates:
                - 1 Sharing: Non-AC â‚¹20,000 | AC â‚¹25,000
                - 2 Sharing: Non-AC â‚¹13,500 | AC â‚¹16,500
                - 3 Sharing: Non-AC â‚¹10,500 | AC â‚¹13,500
                - 4 Sharing: Non-AC â‚¹8,000 | AC â‚¹10,000
                
                Daily Rates:
                - 1 Sharing: Non-AC â‚¹900 | AC â‚¹1,100
                - 2 Sharing: Non-AC â‚¹700 | AC â‚¹900
                - 3 Sharing: Non-AC â‚¹650 | AC â‚¹850
                - 4 Sharing: Non-AC â‚¹600 | AC â‚¹800
                
                To add this information:
                1. Create separate products for each sharing option
                2. Or create one product with detailed description of all options
            `;
            
            alert(tariffInfo);
        }
        
        // Function to help extract information from Word documents
        function extractFromWordDocuments() {
            const extractionGuide = "Product Information Extraction Guide:\n\n" +
                "You have the following Word documents in your Products folder:\n" +
                "1. Just Queens.docx\n" +
                "2. Queens PEARL.docx\n" +
                "3. Queens Sapphire.docx\n\n" +
                "For each document, please extract the following information:\n\n" +
                "1. Product Name:\n" +
                "   - Look for the main heading or title of the PG category\n\n" +
                "2. Description:\n" +
                "   - Copy the main description of the accommodation\n" +
                "   - Include room features and amenities\n\n" +
                "3. Pricing Information:\n" +
                "   - Extract daily and monthly rates if available\n" +
                "   - Note any special pricing or discounts\n\n" +
                "4. Room Details:\n" +
                "   - Number of beds/occupancy\n" +
                "   - Room size or type\n" +
                "   - Special features (AC/Non-AC, attached bathroom, etc.)\n\n" +
                "5. Amenities:\n" +
                "   - List all facilities provided\n" +
                "   - Common amenities: WiFi, Geyser, Laundry, Parking, TV, etc.\n\n" +
                "6. Images:\n" +
                "   - Take screenshots of any photos in the document\n" +
                "   - Or note image descriptions to add later\n\n" +
                "Once you have this information, you can add each PG category \n" +
                "as a separate product using the form above.";
            
            alert(extractionGuide);
        }
        
        // Function to help extract information from Word documents
        function extractFromWordDocuments() {
            const extractionGuide = "Product Information Extraction Guide:\n\n" +
                "You have the following Word documents in your Products folder:\n" +
                "1. Just Queens.docx\n" +
                "2. Queens PEARL.docx\n" +
                "3. Queens Sapphire.docx\n\n" +
                "For each document, please extract the following information:\n\n" +
                "1. Product Name:\n" +
                "   - Look for the main heading or title of the PG category\n\n" +
                "2. Description:\n" +
                "   - Copy the main description of the accommodation\n" +
                "   - Include room features and amenities\n\n" +
                "3. Pricing Information:\n" +
                "   - Extract daily and monthly rates if available\n" +
                "   - Note any special pricing or discounts\n\n" +
                "4. Room Details:\n" +
                "   - Number of beds/occupancy\n" +
                "   - Room size or type\n" +
                "   - Special features (AC/Non-AC, attached bathroom, etc.)\n\n" +
                "5. Amenities:\n" +
                "   - List all facilities provided\n" +
                "   - Common amenities: WiFi, Geyser, Laundry, Parking, TV, etc.\n\n" +
                "6. Images:\n" +
                "   - Take screenshots of any photos in the document\n" +
                "   - Or note image descriptions to add later\n\n" +
                "Once you have this information, you can add each PG category \n" +
                "as a separate product using the form above.";
            
            alert(extractionGuide);
        }
        
        // Function to automatically add all Queen's PG products
        async function addAllQueensProducts() {
            if (!confirm("This will add all three Queen's PG products to your system. Continue?")) {
                return;
            }
            
            try {
                // Get the custom token from localStorage
                const customToken = localStorage.getItem('customToken');
                if (!customToken) {
                    showMessage('Not authenticated. Please log in again.', 'error');
                    return;
                }
                
                // Define all three products
                const queensProducts = [
                    {
                        name: "Just Queens",
                        description: "Located in the dynamic city of Hyderabad, Just Queens is strategically located in Hitec City/Madhapur area is meticulously designed to meet the contemporary woman's requirements, ensuring a harmonious fusion of comfort, convenience, and security. Discover the epitome of luxurious living at Queens PG, where your every need is considered, and your safety and well-being are our top priorities.",
                        category: "PG Accommodation",
                        capacity: 4,
                        amenities: [
                            "Breakfast, Lunch & Dinner (South & North Indian Food)",
                            "Fully automatic Lift",
                            "Mesh Routers in All Floors",
                            "Daily Room Cleaning",
                            "Geyser in All Rooms",
                            "Washing Machines",
                            "Biometric access to resident floors",
                            "Onsite Gym",
                            "Cupboards with Lockers, Attached Bathrooms",
                            "Hi-Speed Wi-Fi >100 MBPS",
                            "Bike Parking & Self-Cooking",
                            "24 Hour Security Surveillance & Onsite security guard",
                            "24x7 Power Backup",
                            "On-site Convenience store",
                            "Onsite Beauty Parlor",
                            "Game room with pool board, foosball, caroms etc."
                        ],
                        // We'll add detailed pricing info in the description since we have multiple options
                    },
                    {
                        name: "Queens PEARL",
                        description: "Located in the dynamic city of Hyderabad, Queens Pearl is right next to Just Queens and is strategically located in Hitec City/Madhapur area is meticulously designed to meet the contemporary women's requirements, ensuring a harmonious fusion of comfort, convenience, and security. Discover the epitome of luxurious living at Queens PG, where your every need is considered, and your safety and well-being are our top priorities.",
                        category: "PG Accommodation",
                        capacity: 4,
                        amenities: [
                            "Breakfast, Lunch & Dinner (South & North Indian Food)",
                            "Fully automatic Lift",
                            "Mesh Routers in All Floors",
                            "Daily Room Cleaning",
                            "Geyser in All Rooms",
                            "Washing Machines",
                            "Biometric access to resident floors",
                            "Onsite Gym",
                            "Cupboards with Lockers, Attached Bathrooms",
                            "Hi-Speed Wi-Fi >100 MBPS",
                            "Bike Parking & Self-Cooking",
                            "24 Hour Security Surveillance & Onsite security guard",
                            "24x7 Power Backup",
                            "On-site Convenience store",
                            "Onsite Beauty Parlor",
                            "Game room with pool board, foosball, caroms etc."
                        ],
                    },
                    {
                        name: "Queens Sapphire",
                        description: "Experience the perfect blend of comfort and convenience! Queens Luxury PG Living is ready to welcome you to a world of tranquility and indulgence. Elevate your living experience with us.",
                        category: "PG Accommodation",
                        capacity: 4,
                        amenities: [
                            "Breakfast, Lunch & Dinner (South & North Indian Food)",
                            "Fully automatic Lift",
                            "Mesh Routers in All Floors",
                            "Daily Room Cleaning",
                            "Geyser in All Rooms",
                            "Washing Machines",
                            "Biometric access to resident floors",
                            "Onsite Gym",
                            "Cupboards with Lockers, Attached Bathrooms",
                            "Hi-Speed Wi-Fi >100 MBPS",
                            "Bike Parking & Self-Cooking",
                            "24 Hour Security Surveillance & Onsite security guard",
                            "24x7 Power Backup",
                            "On-site Convenience store",
                            "Onsite Beauty Parlor",
                            "Game room with pool board, foosball, caroms etc."
                        ],
                    }
                ];
                
                // Add each product
                let successCount = 0;
                for (const product of queensProducts) {
                    try {
                        const response = await fetch('/api/products', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${customToken}`
                            },
                            body: JSON.stringify(product)
                        });
                        
                        if (response.ok) {
                            successCount++;
                        }
                    } catch (error) {
                        console.error(`Error adding product ${product.name}:`, error);
                    }
                }
                
                if (successCount === queensProducts.length) {
                    showMessage(`Successfully added all ${successCount} Queen's PG products!`, 'success');
                    loadProducts(); // Refresh product list
                } else {
                    showMessage(`Added ${successCount} out of ${queensProducts.length} products. Check console for errors.`, 'success');
                    loadProducts(); // Refresh product list
                }
            } catch (error) {
                showMessage('Error adding products: ' + error.message, 'error');
            }
        }
        
        // Upload product images function
        async function uploadProductImages(files, customToken) {
            const imageUrls = [];
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const formData = new FormData();
                formData.append('image', file);
                
                try {
                    const response = await fetch('/api/upload-image', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${customToken}`
                        },
                        body: formData
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok && data.url) {
                        imageUrls.push(data.url);
                    } else {
                        throw new Error(data.error || 'Failed to upload image');
                    }
                } catch (error) {
                    throw new Error(`Error uploading image ${file.name}: ${error.message}`);
                }
            }
            
            return imageUrls;
        }
        
        // Add Resort product function
        async function addResortProduct(e) {
            e.preventDefault();
            
            try {
                // Get the custom token from localStorage
                const customToken = localStorage.getItem('customToken');
                if (!customToken) {
                    showMessage('Not authenticated. Please log in again.', 'error');
                    return;
                }
                
                // Check if files are being uploaded
                const imageFiles = document.getElementById('resortProductImages').files;
                if (imageFiles.length > 5) {
                    showMessage('Maximum 5 images allowed', 'error');
                    return;
                }
                
                // Validate file sizes (2MB limit per file)
                for (let i = 0; i < imageFiles.length; i++) {
                    if (imageFiles[i].size > 2 * 1024 * 1024) {
                        showMessage('Each image should be less than 2MB.', 'error');
                        return;
                    }
                }
                
                // Collect form data
                const formData = new FormData(e.target);
                const product = {
                    type: 'resort'
                };
                
                // Convert FormData to object (excluding files)
                for (let [key, value] of formData.entries()) {
                    // Skip the file input field
                    if (key === 'images') continue;
                    
                    if (key === 'amenities' && value) {
                        // Split amenities into array
                        product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                    } else if (key === 'price' && value) {
                        // Convert price to number
                        product[key] = parseFloat(value);
                    } else if (key === 'capacity' && value) {
                        // Convert capacity to number
                        product[key] = parseInt(value);
                    } else {
                        product[key] = value;
                    }
                }
                
                // If files are selected, upload them first
                let imageUrls = [];
                if (imageFiles.length > 0) {
                    imageUrls = await uploadProductImages(imageFiles, customToken);
                }
                
                // Add uploaded image URLs to product data
                if (imageUrls.length > 0) {
                    product.imageUrls = imageUrls;
                }
                
                // Send product to backend
                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${customToken}`
                    },
                    body: JSON.stringify(product)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('Product added successfully!', 'success');
                    e.target.reset(); // Reset form
                    loadProducts(); // Refresh product list
                } else {
                    showMessage(data.error || 'Failed to add product', 'error');
                }
            } catch (error) {
                showMessage('Error adding product: ' + error.message, 'error');
            }
        }
        
        // Add PG product function
        async function addPGProduct(e) {
            e.preventDefault();
            
            try {
                // Get the custom token from localStorage
                const customToken = localStorage.getItem('customToken');
                if (!customToken) {
                    showMessage('Not authenticated. Please log in again.', 'error');
                    return;
                }
                
                // Check if files are being uploaded
                const imageFiles = document.getElementById('pgProductImages').files;
                if (imageFiles.length > 5) {
                    showMessage('Maximum 5 images allowed', 'error');
                    return;
                }
                
                // Validate file sizes (2MB limit per file)
                for (let i = 0; i < imageFiles.length; i++) {
                    if (imageFiles[i].size > 2 * 1024 * 1024) {
                        showMessage('Each image should be less than 2MB.', 'error');
                        return;
                    }
                }
                
                // Collect form data
                const formData = new FormData(e.target);
                const product = {
                    type: 'pg'
                };
                
                // Collect pricing data
                const pricing = {};
                for (let [key, value] of formData.entries()) {
                    // Skip the file input field
                    if (key === 'images') continue;
                    
                    // Handle pricing fields
                    if (key.startsWith('monthly_') || key.startsWith('daily_')) {
                        if (value) {
                            pricing[key] = parseFloat(value);
                        }
                        continue;
                    }
                    
                    if (key === 'amenities' && value) {
                        // Split amenities into array
                        product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                    } else {
                        product[key] = value;
                    }
                }
                
                // Add pricing data to product
                product.pricing = pricing;
                
                // If files are selected, upload them first
                let imageUrls = [];
                if (imageFiles.length > 0) {
                    imageUrls = await uploadProductImages(imageFiles, customToken);
                }
                
                // Add uploaded image URLs to product data
                if (imageUrls.length > 0) {
                    product.imageUrls = imageUrls;
                }
                
                // Send product to backend
                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${customToken}`
                    },
                    body: JSON.stringify(product)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('PG Product added successfully!', 'success');
                    e.target.reset(); // Reset form
                    loadProducts(); // Refresh product list
                } else {
                    showMessage(data.error || 'Failed to add PG product', 'error');
                }
            } catch (error) {
                showMessage('Error adding PG product: ' + error.message, 'error');
            }
        }
        
        // Add event listeners for the new forms
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for form submissions
            const resortForm = document.getElementById('add-resort-product-form');
            const pgForm = document.getElementById('add-pg-product-form');
            
            if (resortForm) {
                resortForm.addEventListener('submit', addResortProduct);
            }
            
            if (pgForm) {
                pgForm.addEventListener('submit', addPGProduct);
            }
            
            // Load products when page loads
            loadProducts();
        });
        
        // Load products function
        async function loadProducts() {
            try {
                // Get the custom token from localStorage
                const customToken = localStorage.getItem('customToken');
                if (!customToken) {
                    document.getElementById('products-list').innerHTML = '<p>Please log in to view products.</p>';
                    return;
                }
                
                // Fetch products from backend
                const response = await fetch('/api/products', {
                    headers: {
                        'Authorization': `Bearer ${customToken}`
                    }
                });
                
                if (response.status === 401) {
                    // Token expired or invalid, redirect to login
                    showMessage('Session expired. Please log in again.', 'error');
                    setTimeout(() => {
                        showAuth();
                    }, 2000);
                    return;
                }
                
                const products = await response.json();
                
                if (response.ok) {
                    displayProducts(products);
                } else {
                    document.getElementById('products-list').innerHTML = '<p>Error loading products: ' + (products.error || 'Unknown error') + '</p>';
                }
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('products-list').innerHTML = '<p>Error loading products: ' + error.message + '</p>';
            }
        }
        
        // Display products function
        function displayProducts(products) {
            const productsList = document.getElementById('products-list');
            
            // If no products exist, show sample products with instructions
            if (!products || products.length === 0) {
                productsList.innerHTML = `
                    <div class="no-products-message">
                        <h3>No products found</h3>
                        <p>You can add products manually using the form above, or import from your website.</p>
                        <p><strong>To import from your PG pages:</strong></p>
                        <ol>
                            <li>Visit each PG page (e.g., queens-sapphire.html, queens-pearl.html)</li>
                            <li>Extract the following information:
                                <ul>
                                    <li>Product Name</li>
                                    <li>Description</li>
                                    <li>Daily Price (if available)</li>
                                    <li>Monthly Price (if available)</li>
                                    <li>Check-in/Check-out Times</li>
                                    <li>Capacity (Number of guests)</li>
                                </ul>
                            </li>
                            <li>Enter the extracted information into the form above</li>
                        </ol>
                    </div>
                `;
                return;
            }
            
            // Clear existing products
            productsList.innerHTML = '';
            
            // Display each product
            products.forEach(product => {
                const productElement = document.createElement('div');
                productElement.classList.add('product-item');
                
                // Display product name
                const productName = document.createElement('h3');
                productName.textContent = product.name;
                productElement.appendChild(productName);
                
                // Display product description
                const productDescription = document.createElement('p');
                productDescription.textContent = product.description;
                productElement.appendChild(productDescription);
                
                // Display product amenities
                if (product.amenities && product.amenities.length > 0) {
                    const amenitiesList = document.createElement('ul');
                    product.amenities.forEach(amenity => {
                        const amenityItem = document.createElement('li');
                        amenityItem.textContent = amenity;
                        amenitiesList.appendChild(amenityItem);
                    });
                    productElement.appendChild(amenitiesList);
                }
                
                // Display product images
                if (product.imageUrls && product.imageUrls.length > 0) {
                    const imagesContainer = document.createElement('div');
                    imagesContainer.classList.add('product-images');
                    product.imageUrls.forEach(imageUrl => {
                        const image = document.createElement('img');
                        image.src = imageUrl;
                        image.alt = product.name;
                        imagesContainer.appendChild(image);
                    });
                    productElement.appendChild(imagesContainer);
                }
                
                // Display product pricing
                if (product.pricing) {
                    const pricingContainer = document.createElement('div');
                    pricingContainer.classList.add('product-pricing');
                    
                    for (const [key, value] of Object.entries(product.pricing)) {
                        const pricingItem = document.createElement('p');
                        pricingItem.textContent = `${key}: â‚¹${value}`;
                        pricingContainer.appendChild(pricingItem);
                    }
                    
                    productElement.appendChild(pricingContainer);
                }
                
                // Display product capacity
                if (product.capacity) {
                    const capacityItem = document.createElement('p');
                    capacityItem.textContent = `Capacity: ${product.capacity} guests`;
                    productElement.appendChild(capacityItem);
                }
                
                // Display product category
                if (product.category) {
                    const categoryItem = document.createElement('p');
                    categoryItem.textContent = `Category: ${product.category}`;
                    productElement.appendChild(categoryItem);
                }
                
                // Display product actions
                const actionsContainer = document.createElement('div');
                actionsContainer.classList.add('product-actions');
                
                const editButton = document.createElement('button');
                editButton.textContent = 'Edit';
                editButton.addEventListener('click', () => {
                    // Implement edit functionality here
                    alert('Edit functionality not implemented yet');
                });
                actionsContainer.appendChild(editButton);
                
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.addEventListener('click', () => {
                    // Implement delete functionality here
                    alert('Delete functionality not implemented yet');
                });
                actionsContainer.appendChild(deleteButton);
                
                productElement.appendChild(actionsContainer);
                
                productsList.appendChild(productElement);
            });
        }
        
        // Show Resort/Hotel form
        function showResortForm() {
            document.getElementById('resort-form').classList.remove('hidden');
            document.getElementById('pg-form').classList.add('hidden');
        }
        
        // Show PG form
        function showPGForm() {
            document.getElementById('pg-form').classList.remove('hidden');
            document.getElementById('resort-form').classList.add('hidden');
        }
        
        // Add Resort product function
        async function addResortProduct(e) {
            e.preventDefault();
            
            try {
                // Get the custom token from localStorage
                const customToken = localStorage.getItem('customToken');
                if (!customToken) {
                    showMessage('Not authenticated. Please log in again.', 'error');
                    showAuth();
                    return;
                }
                
                // Check if files are being uploaded
                const imageFiles = document.getElementById('resortProductImages').files;
                if (imageFiles.length > 5) {
                    showMessage('Maximum 5 images allowed', 'error');
                    return;
                }
                
                // Validate file sizes (2MB limit per file)
                for (let i = 0; i < imageFiles.length; i++) {
                    if (imageFiles[i].size > 2 * 1024 * 1024) {
                        showMessage('Each image should be less than 2MB.', 'error');
                        return;
                    }
                }
                
                // Collect form data
                const formData = new FormData(e.target);
                const product = {
                    type: 'resort'
                };
                
                // Convert FormData to object (excluding files)
                for (let [key, value] of formData.entries()) {
                    // Skip the file input field
                    if (key === 'images') continue;
                    
                    if (key === 'amenities' && value) {
                        // Split amenities into array
                        product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                    } else if (key === 'price' && value) {
                        // Convert price to number
                        product[key] = parseFloat(value);
                    } else if (key === 'capacity' && value) {
                        // Convert capacity to number
                        product[key] = parseInt(value);
                    } else {
                        product[key] = value;
                    }
                }
                
                // If files are selected, upload them first
                let imageUrls = [];
                if (imageFiles.length > 0) {
                    try {
                        imageUrls = await uploadProductImages(imageFiles, customToken);
                    } catch (uploadError) {
                        showMessage('Error uploading images: ' + uploadError.message, 'error');
                        return;
                    }
                }
                
                // Add uploaded image URLs to product data
                if (imageUrls.length > 0) {
                    product.imageUrls = imageUrls;
                }
                
                // Send product to backend
                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${customToken}`
                    },
                    body: JSON.stringify(product)
                });
                
                if (response.status === 401) {
                    // Token expired or invalid
                    showMessage('Session expired. Please log in again.', 'error');
                    showAuth();
                    return;
                }
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('Product added successfully!', 'success');
                    e.target.reset(); // Reset form
                    loadProducts(); // Refresh product list
                } else {
                    showMessage(data.error || 'Failed to add product', 'error');
                }
            } catch (error) {
                showMessage('Error adding product: ' + error.message, 'error');
            }
        }
        
        // Add PG product function
        async function addPGProduct(e) {
            e.preventDefault();
            
            try {
                // Get the custom token from localStorage
                const customToken = localStorage.getItem('customToken');
                if (!customToken) {
                    showMessage('Not authenticated. Please log in again.', 'error');
                    showAuth();
                    return;
                }
                
                // Check if files are being uploaded
                const imageFiles = document.getElementById('pgProductImages').files;
                if (imageFiles.length > 5) {
                    showMessage('Maximum 5 images allowed', 'error');
                    return;
                }
                
                // Validate file sizes (2MB limit per file)
                for (let i = 0; i < imageFiles.length; i++) {
                    if (imageFiles[i].size > 2 * 1024 * 1024) {
                        showMessage('Each image should be less than 2MB.', 'error');
                        return;
                    }
                }
                
                // Collect form data
                const formData = new FormData(e.target);
                const product = {
                    type: 'pg'
                };
                
                // Collect pricing data
                const pricing = {};
                for (let [key, value] of formData.entries()) {
                    // Skip the file input field
                    if (key === 'images') continue;
                    
                    // Handle pricing fields
                    if (key.startsWith('monthly_') || key.startsWith('daily_')) {
                        if (value) {
                            pricing[key] = parseFloat(value);
                        }
                        continue;
                    }
                    
                    if (key === 'amenities' && value) {
                        // Split amenities into array
                        product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                    } else {
                        product[key] = value;
                    }
                }
                
                // Add pricing data to product
                product.pricing = pricing;
                
                // If files are selected, upload them first
                let imageUrls = [];
                if (imageFiles.length > 0) {
                    try {
                        imageUrls = await uploadProductImages(imageFiles, customToken);
                    } catch (uploadError) {
                        showMessage('Error uploading images: ' + uploadError.message, 'error');
                        return;
                    }
                }
                
                // Add uploaded image URLs to product data
                if (imageUrls.length > 0) {
                    product.imageUrls = imageUrls;
                }
                
                // Send product to backend
                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${customToken}`
                    },
                    body: JSON.stringify(product)
                });
                
                if (response.status === 401) {
                    // Token expired or invalid
                    showMessage('Session expired. Please log in again.', 'error');
                    showAuth();
                    return;
                }
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('PG Product added successfully!', 'success');
                    e.target.reset(); // Reset form
                    loadProducts(); // Refresh product list
                } else {
                    showMessage(data.error || 'Failed to add PG product', 'error');
                }
            } catch (error) {
                showMessage('Error adding PG product: ' + error.message, 'error');
            }
        }
        
        // Show authentication form
        function showAuth() {
            document.getElementById('auth-form').classList.remove('hidden');
            document.getElementById('products-list').classList.add('hidden');
            document.getElementById('resort-form').classList.add('hidden');
            document.getElementById('pg-form').classList.add('hidden');
        }
        
        // Handle authentication
        async function handleAuth(e) {
            e.preventDefault();
            
            try {
                const formData = new FormData(e.target);
                const credentials = {
                    username: formData.get('username'),
                    password: formData.get('password')
                };
                
                const response = await fetch('/api/auth', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(credentials)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    localStorage.setItem('customToken', data.token);
                    showMessage('Logged in successfully!', 'success');
                    loadProducts();
                } else {
                    showMessage(data.error || 'Failed to log in', 'error');
                }
            } catch (error) {
                showMessage('Error logging in: ' + error.message, 'error');
            }
        }
        
        // Show authentication form on page load if not authenticated
        document.addEventListener('DOMContentLoaded', function() {
            const customToken = localStorage.getItem('customToken');
            if (!customToken) {
                showAuth();
            }
        });
        
        // Show message function
        function showMessage(message, type) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', type);
            messageElement.textContent = message;
            document.body.appendChild(messageElement);
            
            setTimeout(() => {
                messageElement.remove();
            }, 3000);
        }
        
        // Upload product images function
        async function uploadProductImages(files, customToken) {
            const formData = new FormData();
            for (let i = 0; i < files.length; i++) {
                formData.append('images', files[i]);
            }
            
            const response = await fetch('/api/upload', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${customToken}`
                },
                body: formData
            });
            
            if (response.status === 401) {
                throw new Error('Session expired. Please log in again.');
            }
            
            const data = await response.json();
            
            if (response.ok) {
                return data.urls;
            } else {
                throw new Error(data.error || 'Failed to upload images');
            }
        }
        
        // Initialize all event listeners
        function initializeEventListeners() {
            try {
                // Authentication form elements
                const loginForm = document.getElementById('login-form');
                const registerForm = document.getElementById('register-form');
                const logoutBtn = document.getElementById('logout-btn');
                const copyTokenBtn = document.getElementById('copy-token-btn');
                
                // Remove these lines as they're conflicting with the correct event listeners
                // if (loginForm) loginForm.addEventListener('submit', loginTenant);
                // if (registerForm) registerForm.addEventListener('submit', registerTenant);
                if (logoutBtn) logoutBtn.addEventListener('click', logoutTenant);
                if (copyTokenBtn) copyTokenBtn.addEventListener('click', copyToken);
                
                // Settings form
                const whatsappSettingsForm = document.getElementById('whatsapp-settings-form');
                if (whatsappSettingsForm) whatsappSettingsForm.addEventListener('submit', saveSettings);
                
                // Settings field change listeners
                const providerSelect = document.getElementById('provider');
                const productApiEnabled = document.getElementById('productApiEnabled');
                const productApiAuthType = document.getElementById('productApiAuthType');
                
                if (providerSelect) providerSelect.addEventListener('change', toggleProviderFields);
                if (productApiEnabled) productApiEnabled.addEventListener('change', toggleProductApiFields);
                if (productApiAuthType) productApiAuthType.addEventListener('change', toggleAuthFields);
                
                // Add Resort/PG product forms (new forms)
                const resortProductForm = document.getElementById('add-resort-product-form');
                const pgProductForm = document.getElementById('add-pg-product-form');
                
                if (resortProductForm) resortProductForm.addEventListener('submit', addResortProduct);
                if (pgProductForm) pgProductForm.addEventListener('submit', addPGProduct);
                
                // Bookings elements
                const refreshBookingsBtn = document.getElementById('refreshBookings');
                const bookingStatusFilter = document.getElementById('bookingStatusFilter');
                const bookingDateFilter = document.getElementById('bookingDateFilter');
                const bookingSearch = document.getElementById('bookingSearch');
                
                if (refreshBookingsBtn) refreshBookingsBtn.addEventListener('click', loadBookings);
                if (bookingStatusFilter) bookingStatusFilter.addEventListener('change', loadBookings);
                if (bookingDateFilter) bookingDateFilter.addEventListener('change', loadBookings);
                if (bookingSearch) bookingSearch.addEventListener('input', debounce(loadBookings, 300));
                
                // Modal close functionality
                const modalClose = document.querySelector('#booking-details-modal .close');
                const modal = document.getElementById('booking-details-modal');
                
                if (modalClose) modalClose.addEventListener('click', () => {
                    if (modal) modal.classList.add('hidden');
                });
                
                if (modal) {
                    window.addEventListener('click', (event) => {
                        if (event.target === modal) {
                            modal.classList.add('hidden');
                        }
                    });
                }
                
                // Load initial data
                loadProducts();
                loadBookings();
                
            } catch (error) {
                console.error('Error initializing event listeners:', error);
            }
        }
        
        // Initialize event listeners when DOM is loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeEventListeners);
        } else {
            // DOM is already loaded
            try {
                initializeEventListeners();
            } catch (error) {
                console.error('Error initializing event listeners:', error);
            }
        }
        
        // Add a simple test to verify button existence
        setTimeout(() => {
            const googleBtn = document.getElementById('google-register-btn');
            console.log('Google button element:', googleBtn);
            if (googleBtn) {
                console.log('Google button found in DOM');
            } else {
                console.log('Google button NOT found in DOM');
            }
        }, 1000);
        
        // Load products function
        async function loadProducts() {
            console.log('[loadProducts] Starting to load products...');
            try {
                // Get the Firebase ID token from localStorage
                let idToken = localStorage.getItem('firebaseIdToken');
                console.log('[loadProducts] firebaseIdToken from localStorage:', idToken ? idToken.substring(0, 50) + '...' : 'null');
                
                const productsList = document.getElementById('products-list');
                
                if (!idToken) {
                    console.log('[loadProducts] No firebaseIdToken, checking current user...');
                    const user = auth.currentUser;
                    console.log('[loadProducts] Current user:', user ? user.email : 'null');
                    
                    if (user) {
                        console.log('[loadProducts] User exists, getting fresh token...');
                        idToken = await user.getIdToken();
                        console.log('[loadProducts] Fresh token obtained');
                        localStorage.setItem('firebaseIdToken', idToken);
                    } else {
                        if (productsList) {
                            productsList.innerHTML = '<p>No products found. Add your first product above!</p>';
                        }
                        return;
                    }
                }
                
                if (!productsList) {
                    console.warn('[loadProducts] Products list element not found');
                    return;
                }
                
                console.log('[loadProducts] Fetching products from API...');
                // Fetch products from backend
                let response = await fetch('/api/products', {
                    headers: {
                        'Authorization': `Bearer ${idToken}`
                    }
                });
                
                console.log('[loadProducts] Response status:', response.status);
                
                if (response.status === 401) {
                    console.error('[loadProducts] 401 Unauthorized - refreshing token and retrying...');
                    const user = auth.currentUser;
                    if (user) {
                        // Get fresh token and retry
                        idToken = await user.getIdToken(true); // Force refresh
                        console.log('[loadProducts] Fresh token obtained after 401');
                        localStorage.setItem('firebaseIdToken', idToken);
                        
                        // Retry request
                        response = await fetch('/api/products', {
                            headers: {
                                'Authorization': `Bearer ${idToken}`
                            }
                        });
                        console.log('[loadProducts] Retry response status:', response.status);
                    } else {
                        showMessage('Session expired. Please log in again.', 'error');
                        setTimeout(() => {
                            showAuth();
                        }, 2000);
                        return;
                    }
                }
                
                if (response.ok) {
                    const products = await response.json();
                    console.log('[loadProducts] Products received:', products.length, 'products');
                    console.log('[loadProducts] Products data:', products);
                    displayProducts(products);
                } else {
                    const errorData = await response.json().catch(() => ({ error: 'Unknown error' }));
                    console.error('[loadProducts] Error response:', errorData);
                    productsList.innerHTML = '<p>Error loading products: ' + (errorData.error || 'Unknown error') + '</p>';
                }
            } catch (error) {
                console.error('[loadProducts] Exception:', error);
                const productsList = document.getElementById('products-list');
                if (productsList) {
                    productsList.innerHTML = '<p>Error loading products: ' + error.message + '</p>';
                }
            }
        }
        
        // Display products function - using safe DOM methods instead of innerHTML
        function displayProducts(products) {
            const productsList = document.getElementById('products-list');
            if (!productsList) return;
            
            // Clear existing products
            while (productsList.firstChild) {
                productsList.removeChild(productsList.firstChild);
            }
            
            // If no products exist, show sample products with instructions
            if (!products || products.length === 0) {
                const noProductsMessage = document.createElement('div');
                noProductsMessage.className = 'no-products-message';
                
                const heading = document.createElement('h3');
                heading.textContent = 'No products found';
                noProductsMessage.appendChild(heading);
                
                const paragraph1 = document.createElement('p');
                paragraph1.textContent = 'You can add products manually using the form above, or import from your website.';
                noProductsMessage.appendChild(paragraph1);
                
                productsList.appendChild(noProductsMessage);
                return;
            }
            
            const productsGrid = document.createElement('div');
            productsGrid.className = 'products-grid';
            
            products.forEach(product => {
                // Create product card
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                
                // Product header
                const productHeader = document.createElement('div');
                productHeader.className = 'product-header';
                
                const productName = document.createElement('h4');
                productName.textContent = product.name || 'Unnamed Product';
                productHeader.appendChild(productName);
                
                // Product price (handle both resort and PG pricing)
                const productPrice = document.createElement('span');
                productPrice.className = 'product-price';
                
                if (product.type === 'pg' && product.pricing) {
                    // Show PG monthly pricing range
                    const monthlyPrices = [];
                    if (product.pricing.monthly) {
                        Object.values(product.pricing.monthly).forEach(sharing => {
                            if (sharing.nonac) monthlyPrices.push(sharing.nonac);
                            if (sharing.ac) monthlyPrices.push(sharing.ac);
                        });
                    }
                    if (monthlyPrices.length > 0) {
                        const min = Math.min(...monthlyPrices.filter(p => p > 0));
                        const max = Math.max(...monthlyPrices);
                        productPrice.textContent = min === max ? `â‚¹${min}/month` : `â‚¹${min} - â‚¹${max}/month`;
                    } else {
                        productPrice.textContent = 'Contact for pricing';
                    }
                } else if (product.price) {
                    productPrice.textContent = `â‚¹${product.price}`;
                } else {
                    productPrice.textContent = 'Price not set';
                }
                productHeader.appendChild(productPrice);
                
                productCard.appendChild(productHeader);
                
                // Product details
                const productDetails = document.createElement('div');
                productDetails.className = 'product-details';
                
                const productDescription = document.createElement('p');
                productDescription.className = 'product-description';
                productDescription.textContent = product.description || 'No description available';
                productDetails.appendChild(productDescription);
                
                // Product meta
                const productMeta = document.createElement('div');
                productMeta.className = 'product-meta';
                
                const productCategory = document.createElement('span');
                productCategory.className = 'product-category';
                productCategory.textContent = product.category || 'Uncategorized';
                productMeta.appendChild(productCategory);
                
                const productCapacity = document.createElement('span');
                productCapacity.className = 'product-capacity';
                productCapacity.textContent = `${product.capacity || 0} guests`;
                productMeta.appendChild(productCapacity);
                
                productDetails.appendChild(productMeta);
                
                // Amenities
                if (product.amenities && product.amenities.length > 0) {
                    const amenitiesDiv = document.createElement('div');
                    amenitiesDiv.className = 'product-amenities';
                    
                    const amenitiesStrong = document.createElement('strong');
                    amenitiesStrong.textContent = 'Amenities: ';
                    amenitiesDiv.appendChild(amenitiesStrong);
                    
                    const amenitiesText = document.createTextNode(product.amenities.join(', '));
                    amenitiesDiv.appendChild(amenitiesText);
                    
                    productDetails.appendChild(amenitiesDiv);
                }
                
                productCard.appendChild(productDetails);
                
                // Product actions
                const productActions = document.createElement('div');
                productActions.className = 'product-actions';
                
                const editButton = document.createElement('button');
                editButton.className = 'btn btn-secondary';
                editButton.textContent = 'Edit';
                editButton.onclick = () => editProduct(product);
                productActions.appendChild(editButton);
                
                const addImagesButton = document.createElement('button');
                addImagesButton.className = 'btn btn-primary';
                addImagesButton.textContent = 'Add Images';
                addImagesButton.onclick = () => addProductImages(product.id);
                productActions.appendChild(addImagesButton);
                
                const deleteButton = document.createElement('button');
                deleteButton.className = 'btn btn-warning';
                deleteButton.textContent = 'Delete';
                deleteButton.onclick = () => deleteProduct(product.id);
                productActions.appendChild(deleteButton);
                
                productCard.appendChild(productActions);
                
                productsGrid.appendChild(productCard);
            });
            
            productsList.appendChild(productsGrid);
        }
        
        // Edit product function
        function editProduct(product) {
            // Show appropriate form based on product type
            if (product.type === 'resort') {
                showResortForm();
                // Pre-fill the resort form
                document.getElementById('resortProductName').value = product.name || '';
                document.getElementById('resortProductDescription').value = product.description || '';
                document.getElementById('resortProductPrice').value = product.price || '';
                document.getElementById('resortProductCategory').value = product.category || '';
                document.getElementById('resortProductImageUrl').value = product.imageUrl || '';
                document.getElementById('resortProductCapacity').value = product.capacity || '';
                document.getElementById('resortProductAmenities').value = product.amenities ? product.amenities.join(', ') : '';
                
                // Change form submit to update instead of create
                const form = document.getElementById('add-resort-product-form');
                form.onsubmit = async (e) => {
                    e.preventDefault();
                    await updateProduct(product.id, 'resort');
                };
                
                showMessage('Edit mode: Update the fields and click Add Resort Product to save', 'info');
            } else if (product.type === 'pg') {
                showPGForm();
                // Pre-fill the PG form
                document.getElementById('pgProductName').value = product.name || '';
                document.getElementById('pgProductDescription').value = product.description || '';
                document.getElementById('pgProductAmenities').value = product.amenities ? product.amenities.join(', ') : '';
                
                // Pre-fill pricing if available
                if (product.pricing) {
                    if (product.pricing.monthly) {
                        Object.keys(product.pricing.monthly).forEach(sharing => {
                            const nonac = product.pricing.monthly[sharing].nonac;
                            const ac = product.pricing.monthly[sharing].ac;
                            const sharingNum = sharing.replace('_sharing', '').replace('_', '');
                            document.querySelector(`[name="monthly_${sharingNum}_nonac"]`).value = nonac || '';
                            document.querySelector(`[name="monthly_${sharingNum}_ac"]`).value = ac || '';
                        });
                    }
                    if (product.pricing.daily) {
                        Object.keys(product.pricing.daily).forEach(sharing => {
                            const nonac = product.pricing.daily[sharing].nonac;
                            const ac = product.pricing.daily[sharing].ac;
                            const sharingNum = sharing.replace('_sharing', '').replace('_', '');
                            document.querySelector(`[name="daily_${sharingNum}_nonac"]`).value = nonac || '';
                            document.querySelector(`[name="daily_${sharingNum}_ac"]`).value = ac || '';
                        });
                    }
                }
                
                // Change form submit to update instead of create
                const form = document.getElementById('add-pg-product-form');
                form.onsubmit = async (e) => {
                    e.preventDefault();
                    await updateProduct(product.id, 'pg');
                };
                
                showMessage('Edit mode: Update the fields and click Add PG Product to save', 'info');
            }
            
            // Scroll to form
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Update product function
        async function updateProduct(productId, productType) {
            try {
                const idToken = localStorage.getItem('firebaseIdToken');
                if (!idToken) {
                    showMessage('Not authenticated. Please log in again.', 'error');
                    return;
                }
                
                let productData;
                
                if (productType === 'resort') {
                    const formData = new FormData(document.getElementById('add-resort-product-form'));
                    productData = {
                        type: 'resort',
                        name: formData.get('name'),
                        description: formData.get('description'),
                        price: parseFloat(formData.get('price')) || 0,
                        category: formData.get('category'),
                        imageUrl: formData.get('imageUrl'),
                        capacity: parseInt(formData.get('capacity')) || 1,
                        amenities: formData.get('amenities') ? formData.get('amenities').split(',').map(a => a.trim()) : []
                    };
                } else if (productType === 'pg') {
                    const formData = new FormData(document.getElementById('add-pg-product-form'));
                    const pricing = {
                        monthly: {
                            '1_sharing': { nonac: parseFloat(formData.get('monthly_1_nonac')) || 0, ac: parseFloat(formData.get('monthly_1_ac')) || 0 },
                            '2_sharing': { nonac: parseFloat(formData.get('monthly_2_nonac')) || 0, ac: parseFloat(formData.get('monthly_2_ac')) || 0 },
                            '3_sharing': { nonac: parseFloat(formData.get('monthly_3_nonac')) || 0, ac: parseFloat(formData.get('monthly_3_ac')) || 0 },
                            '4_sharing': { nonac: parseFloat(formData.get('monthly_4_nonac')) || 0, ac: parseFloat(formData.get('monthly_4_ac')) || 0 }
                        },
                        daily: {
                            '1_sharing': { nonac: parseFloat(formData.get('daily_1_nonac')) || 0, ac: parseFloat(formData.get('daily_1_ac')) || 0 },
                            '2_sharing': { nonac: parseFloat(formData.get('daily_2_nonac')) || 0, ac: parseFloat(formData.get('daily_2_ac')) || 0 },
                            '3_sharing': { nonac: parseFloat(formData.get('daily_3_nonac')) || 0, ac: parseFloat(formData.get('daily_3_ac')) || 0 },
                            '4_sharing': { nonac: parseFloat(formData.get('daily_4_nonac')) || 0, ac: parseFloat(formData.get('daily_4_ac')) || 0 }
                        }
                    };
                    productData = {
                        type: 'pg',
                        name: formData.get('name'),
                        description: formData.get('description'),
                        pricing: pricing,
                        amenities: formData.get('amenities') ? formData.get('amenities').split(',').map(a => a.trim()) : []
                    };
                }
                
                const response = await fetch(`/api/products/${productId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${idToken}`
                    },
                    body: JSON.stringify(productData)
                });
                
                if (response.ok) {
                    showMessage('Product updated successfully!', 'success');
                    // Reset form to create mode
                    if (productType === 'resort') {
                        document.getElementById('add-resort-product-form').reset();
                        document.getElementById('add-resort-product-form').onsubmit = handleResortProductSubmit;
                    } else {
                        document.getElementById('add-pg-product-form').reset();
                        document.getElementById('add-pg-product-form').onsubmit = handlePGProductSubmit;
                    }
                    loadProducts();
                } else {
                    const data = await response.json();
                    showMessage(data.error || 'Failed to update product', 'error');
                }
            } catch (error) {
                showMessage('Error updating product: ' + error.message, 'error');
            }
        }
        
        // Add images to product function
        function addProductImages(productId) {
            showMessage('Image upload feature coming soon! For now, you can edit the product and add an image URL.', 'info');
        }
        
        // Delete product function
        async function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product?')) {
                return;
            }
            
            try {
                // Get the Firebase ID token from localStorage
                const idToken = localStorage.getItem('firebaseIdToken');
                if (!idToken) {
                    showMessage('Not authenticated. Please log in again.', 'error');
                    return;
                }
                
                // Delete product from backend
                const response = await fetch(`/api/products/${productId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${idToken}`
                    }
                });
                
                if (response.status === 401) {
                    // Token expired or invalid
                    showMessage('Session expired. Please log in again.', 'error');
                    showAuth();
                    return;
                }
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('Product deleted successfully!', 'success');
                    loadProducts(); // Refresh product list
                } else {
                    showMessage(data.error || 'Failed to delete product', 'error');
                }
            } catch (error) {
                showMessage('Error deleting product: ' + error.message, 'error');
            }
        }
        
        // Show Resort/Hotel form
        function showResortForm() {
            document.getElementById('resort-form').classList.remove('hidden');
            document.getElementById('pg-form').classList.add('hidden');
        }
        
        // Show PG form
        function showPGForm() {
            document.getElementById('pg-form').classList.remove('hidden');
            document.getElementById('resort-form').classList.add('hidden');
        }
        
        // Add Resort product function
        async function addResortProduct(e) {
            e.preventDefault();
            
            try {
                // Get the custom token from localStorage
                const customToken = localStorage.getItem('customToken');
                if (!customToken) {
                    showMessage('Not authenticated. Please log in again.', 'error');
                    showAuth();
                    return;
                }
                
                // Check if files are being uploaded
                const imageFiles = document.getElementById('resortProductImages');
                if (imageFiles && imageFiles.files.length > 5) {
                    showMessage('Maximum 5 images allowed', 'error');
                    return;
                }
                
                // Validate file sizes (2MB limit per file)
                if (imageFiles) {
                    for (let i = 0; i < imageFiles.files.length; i++) {
                        if (imageFiles.files[i].size > 2 * 1024 * 1024) {
                            showMessage('Each image should be less than 2MB.', 'error');
                            return;
                        }
                    }
                }
                
                // Collect form data
                const formData = new FormData(e.target);
                const product = {
                    type: 'resort'
                };
                
                // Convert FormData to object (excluding files)
                for (let [key, value] of formData.entries()) {
                    // Skip the file input field
                    if (key === 'images') continue;
                    
                    if (key === 'amenities' && value) {
                        // Split amenities into array
                        product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                    } else if (key === 'price' && value) {
                        // Convert price to number
                        product[key] = parseFloat(value);
                    } else if (key === 'capacity' && value) {
                        // Convert capacity to number
                        product[key] = parseInt(value);
                    } else {
                        product[key] = value;
                    }
                }
                
                // If files are selected, upload them first
                let imageUrls = [];
                if (imageFiles && imageFiles.files.length > 0) {
                    try {
                        imageUrls = await uploadProductImages(imageFiles.files, customToken);
                    } catch (uploadError) {
                        showMessage('Error uploading images: ' + uploadError.message, 'error');
                        return;
                    }
                }
                
                // Add uploaded image URLs to product data
                if (imageUrls.length > 0) {
                    product.imageUrls = imageUrls;
                }
                
                // Send product to backend
                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${customToken}`
                    },
                    body: JSON.stringify(product)
                });
                
                if (response.status === 401) {
                    // Token expired or invalid
                    showMessage('Session expired. Please log in again.', 'error');
                    showAuth();
                    return;
                }
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('Product added successfully!', 'success');
                    e.target.reset(); // Reset form
                    loadProducts(); // Refresh product list
                } else {
                    showMessage(data.error || 'Failed to add product', 'error');
                }
            } catch (error) {
                showMessage('Error adding product: ' + error.message, 'error');
            }
        }
        
        // Add PG product function
        async function addPGProduct(e) {
            e.preventDefault();
            
            try {
                // Get the custom token from localStorage
                const customToken = localStorage.getItem('customToken');
                if (!customToken) {
                    showMessage('Not authenticated. Please log in again.', 'error');
                    showAuth();
                    return;
                }
                
                // Check if files are being uploaded
                const imageFiles = document.getElementById('pgProductImages');
                if (imageFiles && imageFiles.files.length > 5) {
                    showMessage('Maximum 5 images allowed', 'error');
                    return;
                }
                
                // Validate file sizes (2MB limit per file)
                if (imageFiles) {
                    for (let i = 0; i < imageFiles.files.length; i++) {
                        if (imageFiles.files[i].size > 2 * 1024 * 1024) {
                            showMessage('Each image should be less than 2MB.', 'error');
                            return;
                        }
                    }
                }
                
                // Collect form data
                const formData = new FormData(e.target);
                const product = {
                    type: 'pg'
                };
                
                // Collect pricing data
                const pricing = {};
                for (let [key, value] of formData.entries()) {
                    // Skip the file input field
                    if (key === 'images') continue;
                    
                    // Handle pricing fields
                    if (key.startsWith('monthly_') || key.startsWith('daily_')) {
                        if (value) {
                            pricing[key] = parseFloat(value);
                        }
                        continue;
                    }
                    
                    if (key === 'amenities' && value) {
                        // Split amenities into array
                        product[key] = value.split(',').map(item => item.trim()).filter(item => item);
                    } else {
                        product[key] = value;
                    }
                }
                
                // Add pricing data to product
                product.pricing = pricing;
                
                // If files are selected, upload them first
                let imageUrls = [];
                if (imageFiles && imageFiles.files.length > 0) {
                    try {
                        imageUrls = await uploadProductImages(imageFiles.files, customToken);
                    } catch (uploadError) {
                        showMessage('Error uploading images: ' + uploadError.message, 'error');
                        return;
                    }
                }
                
                // Add uploaded image URLs to product data
                if (imageUrls.length > 0) {
                    product.imageUrls = imageUrls;
                }
                
                // Send product to backend
                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${customToken}`
                    },
                    body: JSON.stringify(product)
                });
                
                if (response.status === 401) {
                    // Token expired or invalid
                    showMessage('Session expired. Please log in again.', 'error');
                    showAuth();
                    return;
                }
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('PG Product added successfully!', 'success');
                    e.target.reset(); // Reset form
                    loadProducts(); // Refresh product list
                } else {
                    showMessage(data.error || 'Failed to add PG product', 'error');
                }
            } catch (error) {
                showMessage('Error adding PG product: ' + error.message, 'error');
            }
        }
        
        // Check if already logged in
        auth.onAuthStateChanged(user => {
            if (user) {
                // Check if we have a stored custom token
                const storedToken = localStorage.getItem('customToken');
                if (storedToken) {
                    // Show dashboard with stored token
                    showDashboard(user, storedToken);
                } else {
                    // No stored token, show auth screen
                    showAuth();
                }
            } else {
                // No Firebase user, show auth screen
                showAuth();
            }
        });
        
        // Register new tenant
        async function registerTenant() {
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();
            
            if (!email || !password) {
                showMessage('Please enter email and password', 'error');
                return;
            }
            
            try {
                // Create user with email and password in Firebase
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Auto-generate tenant ID from email
                const tenantId = generateTenantId(email);
                
                // Register with backend
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        email, 
                        password, 
                        tenantId,
                        displayName: email.split('@')[0]
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('Registration successful!', 'success');
                    // Store the custom token for later use
                    localStorage.setItem('customToken', data.customToken);
                    
                    // Force token refresh to get the updated custom claims
                    await user.getIdToken(true); // Force refresh
                    const idToken = await user.getIdToken();
                    localStorage.setItem('firebaseIdToken', idToken);
                    
                    // Show dashboard after successful registration
                    showDashboard(user, data.customToken);
                } else {
                    showMessage(data.error || 'Registration failed', 'error');
                }
            } catch (error) {
                showMessage('Error during registration: ' + error.message, 'error');
            }
        }
        
        // Sign in with Google
        async function signInWithGoogle() {
            console.log('Google sign-in button clicked');
            try {
                console.log('Initializing Google sign-in');
                const provider = new firebase.auth.GoogleAuthProvider();
                console.log('Provider created:', provider);
                const result = await auth.signInWithPopup(provider);
                console.log('Sign-in result:', result);
                const user = result.user;
                
                // Auto-generate tenant ID from email
                const tenantId = generateTenantId(user.email);
                
                // Register with backend (this will either create a new tenant or log in existing one)
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        email: user.email, 
                        password: 'google-auth',
                        tenantId,
                        displayName: user.displayName
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('Google sign-in successful!', 'success');
                    // Store the custom token for later use
                    localStorage.setItem('customToken', data.customToken);
                    
                    // Force token refresh to get the updated custom claims
                    await user.getIdToken(true); // Force refresh
                    const idToken = await user.getIdToken();
                    localStorage.setItem('firebaseIdToken', idToken);
                    
                    // Show dashboard after successful Google sign-in
                    showDashboard(user, data.customToken);
                } else {
                    showMessage(data.error || 'Google sign-in failed', 'error');
                }
            } catch (error) {
                console.error('Error during Google sign-in:', error);
                showMessage('Error during Google sign-in: ' + error.message, 'error');
            }
        }
        
        // Generate tenant ID from email (consistent, no random component)
        function generateTenantId(email) {
            // Create a consistent tenant ID based only on email prefix
            // This ensures the same user always gets the same tenant ID
            const emailPrefix = email.split('@')[0].toLowerCase().replace(/[^a-z0-9]/g, '');
            return emailPrefix; // No random suffix - always the same for same email
        }
        
        // Login to existing tenant
        async function loginTenant() {
            const email = emailInput.value.trim();
            const password = passwordInput.value.trim();
            
            if (!email || !password) {
                showMessage('Please enter email and password', 'error');
                return;
            }
            
            try {
                // Sign in with Firebase
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Login with backend
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('Login successful!', 'success');
                    // Store the custom token for later use
                    localStorage.setItem('customToken', data.customToken);
                    
                    // Force token refresh to get the updated custom claims
                    await user.getIdToken(true); // Force refresh
                    const idToken = await user.getIdToken();
                    localStorage.setItem('firebaseIdToken', idToken);
                    
                    // Show dashboard after successful login
                    showDashboard(user, data.customToken);
                } else {
                    showMessage(data.error || 'Login failed', 'error');
                }
            } catch (error) {
                showMessage('Error during login: ' + error.message, 'error');
            }
        }
        
        // Logout
        async function logoutTenant() {
            try {
                await auth.signOut();
                // Clear stored custom token
                localStorage.removeItem('customToken');
                showMessage('You have been logged out', 'success');
            } catch (error) {
                showMessage('Error during logout: ' + error.message, 'error');
            }
        }
        
        // Show message - using safe DOM methods
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            if (messageDiv) {
                messageDiv.textContent = text;
                messageDiv.className = type;
                
                // Clear message after 5 seconds
                setTimeout(() => {
                    messageDiv.textContent = '';
                    messageDiv.className = '';
                }, 5000);
            }
        }
        
        // Show authentication section - using safe DOM methods
        function showAuth() {
            const authSection = document.getElementById('auth-section');
            const dashboardSection = document.getElementById('dashboard-section');
            
            if (authSection && dashboardSection) {
                authSection.classList.remove('hidden');
                dashboardSection.classList.add('hidden');
                
                const emailInput = document.getElementById('email');
                const passwordInput = document.getElementById('password');
                
                if (emailInput) emailInput.value = '';
                if (passwordInput) passwordInput.value = '';
            }
        }
        
        // Show dashboard section - using safe DOM methods
        function showDashboard(user, customToken) {
            const authSection = document.getElementById('auth-section');
            const dashboardSection = document.getElementById('dashboard-section');
            
            if (authSection && dashboardSection) {
                authSection.classList.add('hidden');
                dashboardSection.classList.remove('hidden');
                
                const currentTenantSpan = document.getElementById('current-tenant');
                const currentEmailSpan = document.getElementById('current-email');
                
                if (currentTenantSpan) {
                    currentTenantSpan.textContent = user.email.split('@')[0] || 'Unknown';
                }
                
                if (currentEmailSpan) {
                    currentEmailSpan.textContent = user.email;
                }
                
                // Use the custom token for API requests
                const apiTokenInput = document.getElementById('api-token');
                if (apiTokenInput) {
                    if (customToken) {
                        apiTokenInput.value = customToken;
                    } else {
                        // Fallback to getting from localStorage
                        const storedToken = localStorage.getItem('customToken');
                        if (storedToken) {
                            apiTokenInput.value = storedToken;
                        } else {
                            apiTokenInput.value = 'Token not available';
                        }
                    }
                }
                
                // Populate MyOperator webhook URLs with current domain
                const currentDomain = window.location.origin; // Gets http://localhost:3001 or ngrok URL
                const messageWebhookUrl = `${currentDomain}/twilio/webhook/message`;
                const statusWebhookUrl = `${currentDomain}/twilio/webhook/status`;
                
                const messageWebhookEl = document.getElementById('twilio-message-webhook-url');
                const statusWebhookEl = document.getElementById('twilio-status-webhook-url');
                
                if (messageWebhookEl) {
                    messageWebhookEl.textContent = messageWebhookUrl;
                }
                if (statusWebhookEl) {
                    statusWebhookEl.textContent = statusWebhookUrl;
                }
                
                // Update old webhook URLs with tenant-specific URLs (keeping for backward compatibility)
                const tenantId = user.email.split('@')[0];
                const baseUrl = `https://${window.location.hostname}`;
                
                const bookingStartedUrl = document.getElementById('booking-started-url');
                if (bookingStartedUrl) {
                    bookingStartedUrl.textContent = `${baseUrl}/webhook/${tenantId}/booking-started`;
                }
                
                const bookingAbandonedUrl = document.getElementById('booking-abandoned-url');
                if (bookingAbandonedUrl) {
                    bookingAbandonedUrl.textContent = `${baseUrl}/webhook/${tenantId}/booking-abandoned`;
                }
                
                const reservationConfirmedUrl = document.getElementById('reservation-confirmed-url');
                if (reservationConfirmedUrl) {
                    reservationConfirmedUrl.textContent = `${baseUrl}/webhook/${tenantId}/reservation-confirmed`;
                }
                
                const guestCheckedInUrl = document.getElementById('guest-checked-in-url');
                if (guestCheckedInUrl) {
                    guestCheckedInUrl.textContent = `${baseUrl}/webhook/${tenantId}/guest-checked-in`;
                }
                
                const healthCheckUrl = document.getElementById('health-check-url');
                if (healthCheckUrl) {
                    healthCheckUrl.textContent = `${baseUrl}/health/${tenantId}`;
                }
                
                // Load saved settings
                console.log('[showDashboard] Loading settings and products...');
                loadSettings();
                loadProducts();
            }
        }
        
        // Copy token to clipboard
        function copyToken() {
            const token = apiTokenInput.value;
            if (token && token !== 'Token not available') {
                navigator.clipboard.writeText(token).then(() => {
                    showMessage('API token copied to clipboard', 'success');
                }).catch(err => {
                    showMessage('Failed to copy token: ' + err, 'error');
                });
            } else {
                showMessage('No token available to copy', 'error');
            }
        }
        
        // Copy to clipboard function
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showMessage('Copied to clipboard', 'success');
            }).catch(err => {
                showMessage('Failed to copy: ' + err, 'error');
            });
        }
        
        // Toggle provider fields based on selection
        function toggleProviderFields() {
            const provider = document.getElementById('provider').value;
            
            // Hide all provider fields
            document.querySelectorAll('.provider-fields').forEach(field => {
                field.classList.remove('active');
            });
            
            // Show selected provider fields
            if (provider) {
                document.getElementById(`${provider}-fields`).classList.add('active');
            }
        }
        
        // Toggle product API fields
        function toggleProductApiFields() {
            const enabled = document.getElementById('productApiEnabled').checked;
            document.getElementById('product-api-fields').style.display = enabled ? 'block' : 'none';
        }
        
        // Toggle authentication fields based on selection
        function toggleAuthFields() {
            const authType = document.getElementById('productApiAuthType').value;
            
            // Hide all auth fields
            document.getElementById('bearer-token-field').style.display = 'none';
            document.getElementById('basic-auth-fields').style.display = 'none';
            document.getElementById('api-key-field').style.display = 'none';
            
            // Show selected auth fields
            if (authType === 'bearer') {
                document.getElementById('bearer-token-field').style.display = 'block';
            } else if (authType === 'basic') {
                document.getElementById('basic-auth-fields').style.display = 'block';
            } else if (authType === 'apikey') {
                document.getElementById('api-key-field').style.display = 'block';
            }
        }
        
        // Save settings
        async function saveSettings(e) {
            e.preventDefault();
            
            try {
                // Get the Firebase ID token from localStorage
                const idToken = localStorage.getItem('firebaseIdToken');
                if (!idToken) {
                    showMessage('Not authenticated. Please log in again.', 'error');
                    return;
                }
                
                // Collect form data
                const settings = {
                    productApi: {
                        enabled: document.getElementById('productApiEnabled').checked,
                        url: document.getElementById('productApiUrl').value,
                        authType: document.getElementById('productApiAuthType').value,
                        bearerToken: document.getElementById('productApiBearerToken').value,
                        username: document.getElementById('productApiUsername').value,
                        password: document.getElementById('productApiPassword').value,
                        apiKeyHeader: document.getElementById('productApiKeyHeader').value,
                        apiKeyValue: document.getElementById('productApiKeyValue').value,
                        refreshInterval: parseInt(document.getElementById('productApiRefreshInterval').value) || 60
                    },
                    whatsapp: {
                        provider: document.getElementById('provider').value,
                        accessToken: document.getElementById('accessToken').value,
                        phoneNumberId: document.getElementById('phoneNumberId').value,
                        businessAccountId: document.getElementById('businessAccountId').value,
                        accountSid: document.getElementById('accountSid').value,
                        authToken: document.getElementById('authToken').value,
                        phoneNumber: document.getElementById('phoneNumber').value,
                        apiKey: document.getElementById('apiKey').value,
                        appName: document.getElementById('appName').value
                    },
                    brandName: document.getElementById('brandName').value,
                    brandTone: document.getElementById('brandTone').value
                };
                
                // Send settings to backend
                const response = await fetch('/api/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${idToken}`
                    },
                    body: JSON.stringify(settings)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showMessage('Settings saved successfully!', 'success');
                } else {
                    showMessage(data.error || 'Failed to save settings', 'error');
                }
            } catch (error) {
                showMessage('Error saving settings: ' + error.message, 'error');
            }
        }
        
        // Load settings when dashboard is shown
        async function loadSettings() {
            try {
                // Get the Firebase ID token from localStorage
                const idToken = localStorage.getItem('firebaseIdToken');
                if (!idToken) {
                    return;
                }
                
                // Fetch settings from backend
                const response = await fetch('/api/settings', {
                    headers: {
                        'Authorization': `Bearer ${idToken}`
                    }
                });
                
                const settings = await response.json();
                
                if (response.ok) {
                    // Populate form fields with saved settings
                    if (settings.productApi) {
                        document.getElementById('productApiEnabled').checked = settings.productApi.enabled || false;
                        document.getElementById('productApiUrl').value = settings.productApi.url || '';
                        document.getElementById('productApiAuthType').value = settings.productApi.authType || 'none';
                        document.getElementById('productApiBearerToken').value = settings.productApi.bearerToken || '';
                        document.getElementById('productApiUsername').value = settings.productApi.username || '';
                        document.getElementById('productApiPassword').value = settings.productApi.password || '';
                        document.getElementById('productApiKeyHeader').value = settings.productApi.apiKeyHeader || '';
                        document.getElementById('productApiKeyValue').value = settings.productApi.apiKeyValue || '';
                        document.getElementById('productApiRefreshInterval').value = settings.productApi.refreshInterval || 60;
                        
                        // Update UI based on settings
                        toggleProductApiFields();
                        toggleAuthFields();
                    }
                    
                    if (settings.whatsapp) {
                        document.getElementById('provider').value = settings.whatsapp.provider || '';
                        document.getElementById('accessToken').value = settings.whatsapp.accessToken || '';
                        document.getElementById('phoneNumberId').value = settings.whatsapp.phoneNumberId || '';
                        document.getElementById('businessAccountId').value = settings.whatsapp.businessAccountId || '';
                        document.getElementById('accountSid').value = settings.whatsapp.accountSid || '';
                        document.getElementById('authToken').value = settings.whatsapp.authToken || '';
                        document.getElementById('phoneNumber').value = settings.whatsapp.phoneNumber || '';
                        document.getElementById('apiKey').value = settings.whatsapp.apiKey || '';
                        document.getElementById('appName').value = settings.whatsapp.appName || '';
                        
                        // Update UI based on settings
                        toggleProviderFields();
                    }
                    
                    document.getElementById('brandName').value = settings.brandName || '';
                    document.getElementById('brandTone').value = settings.brandTone || 'friendly';
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }
        
        // Show message
        function showMessage(text, type) {
            messageDiv.textContent = text;
            messageDiv.className = type;
            
            // Clear message after 5 seconds
            setTimeout(() => {
                messageDiv.textContent = '';
                messageDiv.className = '';
            }, 5000);
        }
    </script>
</body>
</html>